好的那首先欢迎各位朋友们来到铃声交易
我是威克
这节课主要是给大家分享的内容啊
专门讲解这个内存分配器
那本节课的话呢
我们从四个点进行进一步来学习
第一个我们要掌握一个什么伙伴系统
第二个呢我们要知道如何创建分配
释放slab对象
第3KMACOVMACO系统调用哪个实现
第四个是回收页面
KSM如何进行实现
这是本节课我们要掌握的一个内容
那么首先我们来看第一大点
那么伙伴系统啊它是什么
是最常用的一个内存分配算法
那么LINUX内核它这个底层啊
一分配算法其实呢它就是伙伴系统
那么火方系统我们在使用的时候
它有一个什么优点
优点是什么
就是分配和回收的速度是特别快
减少什么
减少这个外部碎片
那么这个伙伴系统呢要注意啊
它主要进行什么配置页分配
它也是LINUX最底层的一个分配
那么其他这些分配算法都是以分配为基础的
你比如啊这个X86
他这种架构就是每一个配置啊
它就是4KB
那么LINUX呢对内存进行分配啊
它就包括这个什么啊
低端内存
高档内存啊
DMI区域啊等等
他还对什么呢
对NUM架构做了很多处理
就是对那个页面进行分类等等啊
但是现在我们最主要的是什么呢
你要了解这个啊build这个算法
那么我们只提起它核心的部分
你比如啊他可以什么呢
在控制台下进行执行
那么这个伙伴系统它这个数据结构啊
在内核源码分析里面
前面我给大家讲过了
就是每个链表它可以保存一些什么呢
啊保存这个相同大小的一个内存块
那么最大的是十啊
也就是1024为基本单位
所以说LINUX内核X86的一次最多可以分配四个
四兆
就是4MB啊
这个在前面的章节当中
我已经给大家提过了
那么现在我们就来看一下要注意这个问题
什么意思呢
就是LINUX内核
那么使用什么使用二进制啊
这个伙伴系统伙伴算法来管理和什么呢
和分配这个物理内存页面
对不对
但是我们所讲的一个伙伴系统啊
它是什么
它是基于什么
基于二的R2的方幂
二的多少次方是吧
二的方次幂
爱的方次幂分配和什么呢
和空弦缓存的这个什么
就是我们所讲的一个什么呢
缓冲区进行什么合并技术的一个内存分配方案
唉他主要是做这个事情
那么我们了解这个字号
还必须要掌握一个什么呢
那么在整个系统当中系统分配啊
这个物理液它是怎么做的
就是这个系统内存中
这是每一个什么呀
每一个物理页内
每个物理内存啊
内存页
那我们把它叫做什么
叫做一页针
对不对
他就对应一个什么呢
专门对应的structure page啊
这么对这么一个啊实力也可以叫结构体
是不是啊
但是它每一个内存区域就是每个内存一样
他都会什么都会直接关联一个什么啊
STRUCTORZONE啊
这个实例
然后呢其中哎它可以保存用于什么
用于管理我们这个虎伴系伙伴数据
的一个什么主要数组
那么它在哪里呢
大家注意啊
那么在什么
在include
你看他专门有一个数据进行了存储保护
这个数据怎么打开
这里面看到没有
它有一个什么
有一个in loud
你注意啊
在include下面的LINUX
那么LINUX下面装了一个什么mm开头的
mm z o n e哎
这地方双击三次之后呢
我们会找到一个什么
找到一个这个结构
你看看加F然后有一个什么
你就查一下这个下划线
这一看就这个
等一下啊啊就这个结构体看到没有啊
就是这个结构体内存区域关联这个啊
但是这里面呢它又有哪些呢
你看这里面有很多个成员啊
比如这个下划线watermark
对不对啊
还有什么watermark下划线boost
对不对
再往后面专门有个什么low m e m下划线
Reserve max in r zones
再往下面你看没有
Pg list date
有配CPU
也就是每个CPU这个页啊
每个CPU page se
你看一直往后面
那么针对这个结构体对不对
那我们要搞清楚几个问题啊
我们再回头过来看这个嗯
这个我们就已经告诉了大家了啊
就是你要知道他到底是怎么回事
在哪个地方是吧
等一下我们针对它进行进一步的分析就可以了
双击哎
就这一个是吧
好那么这个下面呢他就专门有一个什么数组
对不对
就是主要数组啊
专门一个叫做什么叫做frail下划线
这个list没有
那么这个frail list
你看frail下划线error
看到没有
你看list head felix是不是存储起来
对不对
这个结构体要注意啊
它是个辅助的一个数据结构
什么意思呢
它是这样的
它就相当于什么呢
相当于我们现在就是这个tractor for real下划线
这个什么error
它是一个什么
它是我们伙伴系统的一个什么辅助数据结构
对不对
辅助数据结构啊
它具体如下
我们来看一下啊
具体如下有哪些呢
嗯大家注意几个问题啊
就刚刚我们所给大家讲解这个frail at least
这个地方没有啊
就来乘除这个好
那你了解这个之后呢
那么下面有个什么frail air list
它是一个空闲页的一个链表
要搞清楚
就是这个frail
下划线有一个什么呢
list它表示什么
表示用于什么呢
连接这个空闲页的一个链表
对不对
那么这个我们所讲的这个链表啊
它包含什么呢
大小相同的一个什么相同的一个连续内存啊
联系内存区域
这是其中的一个参数
就是其中的一个参数
这个成员好
那么还有一个啊
还有一个还有哪个呢
还有一个这个NR下划线
看到没有
NR下划线有一个什么FRAL哎
这个是干什么的
这个它表示指定什么
表示指定我们当前当前什么
当前这个内存区域当中的一个什么
空闲一块的一个数目是多少数量
那么对于什么呢
被连接啊
对连接内存它为什么呢
他会足O哎
他会逐渐的进行计算
但是对于什么呀
对一阶的这个内存区诶
他就会计算什么计算页
对应的一个什么数目是多少
那么如果你对于什么两阶的这个内存区
2000的成绩呢
它就计算为什么计算为四页哎
集合的一个什么数目
你二的零次方嘛
对不对
二的零次方的一次方
对不对
这样的话我们可以什么可以依次类推
哎大家注意这个问题就行了
要搞清楚啊
好那么现在在我们整清楚啊
这个相关问题之后啊
那么有一个什么呢
就是在这时候讲对一阶啊
一阶的数目对不对
二阶的是为四
一阶的话
一阶数目的话
你看二的一次方是不是对零阶
二的零次方是一嘛
对不对
二的一次方是二二的二次方
对不对
就是四
对不对
他按按照这个思路来
所以说在内存分配的时候
他是这么处理的啊
内存配就是你这个注意啊
哎你这个内存分配的这个数量单位啊
它是以什么呢
就是内存块
内存块的长度呢
它是为I的是多少次方
那就这么做
A的A的次方啊
然后连OORDER是不是注意啊
其中我们这个OO的一个范围要搞清楚啊
O的一个范围二的范围它是从甲从零到多少呢
零到马克思下划线这个OADORDER次方啊
一直到这个是大家搞清楚啊
好那么现在我们澄清了这个之后
那么你怎么知道他是爱的这个MARKO呢
ADD max的话我们可以找到啊
它有一个对应的关系
我们可以看到这
你看专门一个什么井号defi max是什么呢
max2的最大为什么为11
所以你要注意这个问题啊
他就在这个地方
我们就可以推出来了
是不是你写代码是按这个来好
那我们搞清楚之后
那么接下来什么呢
就是它最大啊
就是最大接最大
接这个马克思下划线O它跟哪个呢
跟我们这个force下划线专为一个什么Mark下划线
zone z n这个EZRO哎
他专门有一个什么专门有一个配置选项
对不对
那么其中我们所讲的max下划线
这个O它的一个什么默认啊
默认我们是定义为什么呢
11
但是我们这个请求啊
你看啊哎这个请求页请求页数呢
它最大是多少呢
最大是二的多少次方嗯
二的11次方就等于2048
哎就这么个意思啊
就这么个意思啊
那我们整清楚之后呢
其实他这个空闲页它从0~9是不是
0~9是十个
这号最大就是11个
看到没有
那fl下划线l rot是不是啊
空弦0123456789
max order就是最大11
你看比如20多次方呢
比如我们九九的这些皆为九的话
你看I的max or直接捡起来减一嘛
就到这了
是不是这里面有几个页面
四个是不是啊
比如你这个零和二的零次方
这个页面有几个有四有五个空闲页
二的四次方
二的二的四次方
即使四个页面是空闲的
那么下面I的max out这里有几个呢
有两个页面是空闲的
所以我们按照这个思路啊进行进一步可以调整
对不对
那我们还有哪个地方可以看到那些东西呢
大家注意啊
我们可以使用什么
比如这个伙伴系统
伙伴系统和什么呢
和当前的一个状态信息
我们可以什么
大家可以查阅一些相关资料啊
你们通过什么来通过cat杠PLC
下面有个什么building information
那这个就可以查看的结果
那在哪里呢
大家等一下啊
我们打开哪里来打开这个
虚拟机
大家看一下啊
好那我们打开这个虚拟机操
你执行一下看
别着急
这样的话我们就可以看得到他那个结果是吧
等待一下啊
好进来
好那么这个进来之后啊
大家注意了
嗯到这方来
这里有黄金区啊
su root是没有O那么刚才讲了
我们通过这个cat plc
下面有个什么火光系统的一些相关信息
你回车键显示不显出来
对不对
你看这个node是不是ZDMI
里面还有DMI3i norm了
对不对
每个区域都全部告诉了我们
这比较小
是不是这个大小
你看啊
自动调整大小
嗯这个不好对
是不是
但是啊他基本这个思路如何实现
这个请告诉大家看看你是不是可以看到了
对不对
这边啊DMDM3还normal了
那么就直接什么呀
直接在我们这个笔记里面就放到这个位置
看诶怎么又跑到栅栏
Ok
嗯就在这里
那这个我们搞清楚之后啊
所以我们在用的时候
大家一定要注意一些相关细节问题
那你怎么设计呢
对不对
你如何进行实现
比如这个算法你怎么写
注意啊
就是LINUX内核
它对链表的各种操作
大家一定要注意它是一个什么
它是一个双向链表
就说你看你写代码的时候
你看别人怎么设计
你看这个原代码
嗯掩码设计与实现是吧
野马设计实现
至少我们有一个思路
对不对
那么这个思路我们怎么做呢
你比如现在我干什么呢
你看啊
好大家等一下啊
现在我们来观察一下这个怎么做啊
是比如现在我们单击这个你有新建文件是吧
那我在新建文件里面
我先上来给他保存一下
我保存了这个桌面这个名称我们就自己取
自己取这个什么呢
有关于我们这个LINUX内核他的一个什么链表啊
这link list点C是吧
它的一个设计方式
那么一般情况下我们在设计它就有一个框架
你在写代码给我们
在主函数include s t t r o点H
你看怎么设计啊
你再写上去专门有个什么string string
后面呢就专门有一个什么s t t label点H
接着再来一个什么这个unset红啊
a unset点H完了之后呢
我们直接main ok看整个设计这个方式
我们可以按照这个思路啊
这个写好
比如你这个你怎么做呢
那我们设计的时候你还没写好啊
现在我们在这个卖函数里面
卖函数里面第一步的话
我们要调用什么呢
就是以系统啊
就是我们要初始化什么
初始化这个内存管理各项参数
这是第一个吧
第二个
那么你要测试什么呢
第二步的话
第二步我们要测试
你要测试什么呢
测试这个伙伴系统
Build system
测试伙伴系统对不对
最后我们就要干什么
就退出不退出这个程序就可以了
嗯基本思路我们做到这一点
那我们把这个搞清楚之后
那你怎么去做呢
怎么去设计呢
大家要注意这个点
那第一个是什么
第一个啊
第一点要设置一个什么双向链表
哎我们要定一个双向链表
那你就写个STRUCTOR
没有list
你跟系统里面差不多啊
这个都套用啊
list下划线装了一个什么head
看你发括号里面
那上面有个分号
里面有个成员
两个指针要做好
那就是list head
看到没有
那么就写上星号
这第一个第二个next
那么这个双向链表里面有两个啊
有两个
那么这两个的话呢
那下面是什么呢
你要设置一个什么
你要设置一个存储空闲内存啊
就是链表
你要做一个链表
存储空闲内存
那前面刚才是不是也提到过了
对不对
你用系统里面啊
比如现在我们要第一个
定义存储存储什么存储空闲的一个内存啊
type define没有好
type d化之后呢
后面我写什么呢
写STRUCTOR
你看FAL下划线error
这个是不是刚刚讲过了
包括里面有两个成员
对不对
一个是strut
套用上面啊
List head
对不对
那么你写上FRA下划线list
这是第一个
这个地方是干什么
这个地方的主要作用
主要作用呢
它是将什么呢
将内存块
将内存块直接连接到什么
连接到空弦的这个链表当中
就这个意思
第二个呢我们有inside on song
好in啊
下划线这里刚刚讲了吗
Frail
那为什么需要这个呢
这个就是将什么将每一个链表空闲的
一个什么空闲快的一个个数啊
统计对不对啊
就这个意思好
他就干这个事情了
那么这个地方做好之后呢
那后面我们就应该怎么做呢
应该就是通过这个frail定一个类型
那就下划线error
下划线tap
那么后面这个结构体类型
是由我们自己来处理的
自己来处理
还你还定一个什么
还定一个页嗯
大家要注意这个问题啊
你还定个页
是不是
那么这个页是怎么做呢
嗯大家要注意这个相关的细节问题啊
OK是不是
好我们看一下啊
那这个这个如何实现呢
你看啊
这里面的话我们就设置一个什么配置
配置的话
你就直接写一个什么
直接写一个structure
写一个配置
发括号里面
那我写什么呢
比如写STRUCT这个什么list下划线head
配置下划线link什么的就可以了
这个页的一个链接再定个多少结束
在写什么呢
On side
好inside什么on side int size
那我们的设计就按这个来
这个是连接到上面啊
那么这个是什么呢
这是表示什么意思啊
第19行
这个地方它是表示我们这个表示
就是当前对应啊
当前对应这个什么页面所在啊
所所在的一个什么阶
第几节第几阶就这个意思好
还有一个什么
还有一个是size
那这个size是什么意思呢
就是如果啊
比如比如什么呢
就是你当前这个页面啊
当前页面他最开始就是起始页面
它就是什么呢
起始页面就是我们所讲的一个size
就是专门用来表示什么
表示连续的一个页面数
对不对
那么一般情况下这个我们是设备减零就足够了
这就是我们设计这一块好
还有一个问题啊
你要定一个什么呢
我们定一般字符型
对不对
你定为unity u INT8
那么方便我们后面进行使用多少个页面数
这个由我们自己来决定
就是说比如我写一个什么
仅靠define
再来一个什么配置
下划线有一个什么size
那这个是什么意思啊
这个就是4096
4096
这地方告诉我们是什么呢
就是基本的一个什么嗯
基本的一个分配单位
那么再往下面就是页面的个数
那我就写个井号define
再写一个什么配置
下划线装一个什么numbers
那么写4096
这个是表示什么呀
好页面的一个个数
你看唉这些问题我们就搞定了
是不是OK好
那这个问题我们解决之后还有什么呢
还有一个max ord就必须把它定义出来
就立F是吧
哎井号立FS号呢
专门一个max or max的什么呢
你就写11
这个是标准化的啊
包括一些页面管理
比如你需要管理内存
你怎么做管理内存
就把这两个乘起来就可以了
要注意啊
还有什么呢
还有一个memory map
那就一般就是指这个了
Page number free at least
就是我们这个了
就是max order
这个你自己定是吧啊
你怎么还有个什么
还有一个是地址转换到页页之间的地址转换
这个图标都得搞清楚
你写代码的时候
你要按照这个思路
按照这个思路一步一步来实现啊
怎么去实现呢
你看比如举个例子
我们写一个这样写吧
上面先定义啊
怎么定义呢
那我就写一个type define
自定数据类型inside try
那我定义什么
UINT8嗯
下划线type
我是通过这个制定类型来定义
下面我所需要的一个部分是吧
那么第一个我们定义的是什么呢
就是管理这个内存
你管理内存的话大小那就type是吧
定个m m memory memory下划线什么呢
size那么机体是多少
那你就用哪个呢
用这个page size a page下划线再次再乘上什么
乘上这个配置下划线numbers
把这两个存起来啊
这个大写S啊
把它存起来是不是这个就可以了
哎你把这两个乘相乘之后啊
那么下面再来一个什么
再来一个这个对应的这个内存管理是吧
就写上structor page
好memory下划线下划线再写一个什么map中括号
那就直接写pages下划线numbers
这就搞好了
搞好之后还有一个什么
还有一个空闲区域
那就通过这个frail下划线
Error tp
通过它来管理
那么就写上frail下划线
error fl下划线LEA中括号
那我写上什么
写上max下划线
是不是就处理好了
好那么这个地方我们写好之后
这个类型是在我上面已经订好了
看到没有用来管理存储
我们这个空闲内存就在这个上面啊
那这个写好之后还还注意一个问题
什么就是这个你如何将这个地址啊
而转换到页页跟地址之间转换
所以一般情况下
我们在定的时候是怎么做到的呢
你看这边他怎么做到的
它是什么呢
井号DEFI
自己定一个ADDR地址到什么to下划线配置
那么你把地址传进来ADDR
这第一个是第二个井号define
那么再来一个什么配置
page图什么呢
ADD啊
括号
那么这个地方是page
就是页啊
转换成对应的一个地址
那么后面后面这个设计我们是怎么做到的呢
要搞清楚啊
你后面那个设计就是你写这个伙伴系统
这个设计的啥
你比如它它一般是什么
一般是onside
无符号整形嗯
一般是5号整形
然后你再强制这个UINT8TP是不是
然后强制转换
你对那个地址你传过来啊
减伤什么呢
memory size就可以了
最后你要除上什么
除上个总页数
除上那个page size
最后外面你打个括号
那么外面这个括号是哪个
对这个跟那个跟那个没问题
两个把它扣起来
再少一个括号
Ok
好外面这里啊
等一下没问题
第二个括号对应这个没问题
这个跟那个对
这个跟那个对那个对
啊这里面就可以了
好完全没问题
OK可以了
好下面这个下面这个你是哪个长
哪个是配置长了个JS
你配置转adj的话
那就是我们设计的时候就on side int啊
那么你把这个页啊就是page to啊
P分page two下划线这个偏移pf括号
那么你把这个页给转出来
再乘上这个page size
看到没有
再加上内存
它的一个memory大小size是不是这样写的
但是这个类型你怎么做到呢
这个类型就是你用这个E减去什么
减去内存有多少页
减那个内存页嘛
在上面要把它做好
就是通过这个井号地方有一个配置页
page to to什么呢
To pf
你强转的时候用到了onside inside什么int page减去括号
这个配置减去什么memory map
它的设计方式就这样了
你这个要跟这个配起来是不是
否则的话你这个就不好用了啊
否则就不好用了
所以我们设计这个内核的时候
内存管理确实有点难
好完了之后
那么接着什么呢
接下来我们在内核这个链表怎么做内核链表
比如啊我们这个LINUX内核
LINUX内核内核什么呢
现在你初始化双向链表
你初始化出现
代表你不可能写一段等于复杂的代码
一般我们是通过什么井号DEFI
井号DEFI这个红灯是吧
那你写成list head
看没跟我们在学内核源码分析那个是一样的
List head
IIT哈
你把这个名字参数带进来
带进来之后呢
你带两个参数吗
name啊
第一个name
第二个逗号再来一个什么name
看这是不是你调那个红
调那个红给它附带有参数就可以了
就这么简单啊
那这是这个
那么你如何进行初始化设计的话
你怎么做到的呢
像这个你由此展开往下走的话
那就写上啊
Tt in line
再来一个什么way的名字好
你前面就套上一个结构体是吧
List head
这个是不是在前面刚刚讲的啊
你这个结构体就直接把它用起来了
用起来之后
那么你要讲什么
你要将这个list啊
像list分别覆盖什么
分别指向我们这个嗯
分别指向那个PREVIDEO是吧
还有一个是next
你要把指向这两个链
这两个链表链表的这两个节点啊
就是两个成年啊
对不对
那你就是通过list指向好next
对不对
等于list初始化它嘛
你看他这个是不是比较跟我们平时写的
有点不一样
是不是等于什么等于list
你看这个这个成员就等于上面这个PRA
看到没
这个你这个next等于下面这个
这两个是不是已经复制了
复制之后还有一种方式
就是说我们在两个
比如你在两个元素之间啊
这个确实有点复杂
对不对
有点复杂
那比如现在我在两个元素之间
我们是不是一个双向链表
对不对
你是不是三个节点呢
3000点的话
你这个next指着来
是不是你的PO这样画吧
哎你这个节点是这样的
是不是啊
你这个next是指向这个地方来吧
你这个PO在这呢
什么你的next是不是存放这个你的pro是通用
这个是吧
但是现在你要想在什么
比如你想的A这个节点和B这个节点之间
还有这个时候你要插入一个节点是吧
你查这个节点的话
那你怎么指向来查节点
非常简单呢
你这个时候你要讲什么
你要将你这一根next指到这来
就这个意思是不是这next真来啊
然后呢你这个你下面那个你抄这个D这个节点
那么你这个next这个next要指到哪里
要存放到这来
对不对
你这个PO要指向这个位置
你这个PO要指向这个位置
就是黄色的这个地方
你才能够把中间这个套起来
你才把中间那个乘起来
就是在内核它的一种用法
内核的一种用法
大家一定要搞定啊
那么这种初始化方式
那我们大家必须要对什么
必须要对数据结构非常熟悉的情况下
才能够解决
你
比如我们在什么呢
在任意两个啊
在任意两个两个
什么两个节点之间插入一个什么
能跟节点之间插入一个temple啊
那就是中间那个节点插入这个new node啊
你怎么插入
那么你要实现抄这个new node的话
你在写这个static inline boy的下划线list
这个初始化end添加添加节点节点里面
它所对应的成员你怎么负责
所以这个还是那个啊
第一个我们必须要什么呢
你初始化过程当中
那么你这个STRUCTOR装了一个什么list head
星号new是不是这个意思啊
这个也放到里面去啊
三个参数
第一个
第二个
第二个以这个时
啊struct list head
嗯再次信号PRAI
你看这个结构体怎么用啊
下划线head型号next是不是这么写
但是当我们用到这个函数的时候
用到这个下划线下划线list head的时候
那我应该怎么做呢
你这个new你看怎么做啊
刚才我已经画图了
是不是
那我们来设计一个是new的next
new的next给哪个呢
new next就得到next是吧
好然后什么呢
PV6就是前驱它的一个next
前期的next他就会得到什么
得到new是吧
还有一个是next gun所指向的一个什么指向
那个pre view就等于什么new
然后呢你这个new preview
preview will他就得到什么呢
得到preview诶
它的设计模式
你看跟我们平时设计是有一定的差别
是不是有点不太一样
所以我们要习惯啊
大家习惯这种用法就可以了
并不难啊
并不难啊
这就是我们在什么呢
这这种方法是叫做什么
叫做任意两个元素之间
对不对
我们插入一个new node
就这个意思
你也可以什么呢
你也可以在这个链表啊
在链表头插入一个新元素
那就相当于头插画了
要注意啊
相当于头插法
那么头插法的话大家用过没啊
你看什么图插法
尾插法
链表面灵活应用呢
在内核里面啊
你比如在什么
就相当于在这个链表
在链表的头部插入一个新元素节点是吧
嗯就相当于嗯
相当于头插法对不对
那如果还有一种叫什么呢
在链表的一个什么
如果你在链表的尾部插入一个什么呢
新元素节点相当于什么呢
相当于这个尾插法嗯
就这个意思
那么头插法和尾插法就是唯独他们两个
变换一下位置就行了
套用这个是不是你怎么用呢
你看啊并怎么用那么一样的static inline void list
and你写上structor list AD头节点是吧
new一下就可以了
然后在list head星号head
那么里面来执行
你就套用了两个下划线就可以了
你list head括号
你new一下head
然后在你这个head指向的X付给他
他就是按照这种方式来处理
这是头插法
头插法就摆在这来
那如果尾插好的话
你就把CV6摆到中间
开得摆到后面就可以了
它的设计方式方法就是这样的好
那么下面的话呢你看比如说static inline void list
下划线and什么and啊
这是上面是头插法
头插法的话是and head头插画
下面是尾插画
tell tell括号啊
structor list下划线head成new一下structure list什么呢
pad型号pad来发号里面的执行是什么
同样的你调那个上面自己定的啊
这个list and new一下new这个节点它的一个什么
pal preview逗号head
你看他的操作
它就成这种方式
这是非常简单
这个链表啊
就是LINUX内核链表的设计时间是如何应用
那么这个写完之后呢
那么接下来什么呢
接下来大家注意啊
除了这个以外
list head是不是下面我们比如你删除节点
是不是就是删除节点
就说两个节点之间进行操作
是不是比如你删除节点
删除在列表当中删除这个节点
删除节点你是在什么
就相当于在两个节点之间删除操作
那就写一个static
看到没有inline
你看啊
void的下划线list delete看到没有
都可以自己定啊
括号里面什么
你看括号里面structor structure
什么list
下划线配的星号
real instructor list head型号next啊
这个你删除非常简单
删除
你就把next当前节点的next赋给prevision
Next
把那个当前的PV付给next prevenue
这两个是不是就可以连起来了
就这个意思啊
指向next得到的是
那你这个next指向了一个什么PERIAL等于premier
你看这样是不是就可以两者就可以套起来了
这个这个是完全没问题啊
少一个尖括号
是不是
你看就这一块
这是两个节点删除操作
那么你要实现删除对不对
那么就必须拿来
比如你删除节点好
下面我们用链表的时候
要实现删除这个节点操作
那我们要实现删除节点操作
那就通过什么呀
static inline void的下划线list什么delete
然后再来一个
再来一个new
new node括号
struct list head嗯
那这个自己写上这个参数就可以了啊
好那这个写完之后呢
那接着list delete删除是吧
那我们上面这个删除就调用上面那个了
其实他这个删除
那我们可以将这个商量三图就可以别写错啊
调用它
调用它之后
你通过什么new node指向P看到没有
然后you know指向next
你看这是不是就全部做好了嗯
在操作完成之后啊
比如你删除成功之后
那就说你删除成功之后
你一定要什么
一定要将两个指针设为空
就是你拿那个指令PVUE跟next设为空啊
下面就是删除节点
删除节点并且删除节点
且将什么
将这个next preview直接把它置为什么置为空
思维空大话是static inline void list
下划线delete删除
看到没有括号
Structor
h list啊
括号struct list head
星号node就这么定
那怎么做呢
那你调用上面那个list
Delete enter new node
把这个节点传进来
传进来之后
你再把这两个词称之为科目就可以了
node指向next
就等于什么空
还有一个什么呢
还有一个是node指向这个和real等于什么呢
空整体设计方式就这么简单
还有什么啊
大家注意啊
整个在内核的这个链表应用啊
它是非常的复杂啊
也是比较详细的
就是大家在设计的过程当中啊
一定要注意这些相关的细节问题就可以了
你比如啊
你把其中的一个链表节点
移到另外一个链表的部分
或者啊
你把其中的一个链表节点移到另外一个链表
末尾或者头部
是不是判断链表是否为空
包括你这个链表是否是最后一个节点
那么整个设计方式那一定要跟进啊
这个思路来
你看这个设计全给他做好了
是不是
所以链表的一个在内核当中
它的应用啊算是比较复杂的
那么这个啊我们就已经解决了
是不是解决之后
那么接下来是什么呢
就是链表
在LINUX内核的什么应用这个架构是不是就可以了
好还有一个什么
还有一个
接下来我们要掌握的是本节课当中的第二大点
第二大点的话呢
大家注意啊
你只要掌握这几个问题就行了
哪几个问题啊
跟着这个思路来就可以了
关键你还是要掌握什么
掌握这个API是不是什么意思啊
就比如相当于什么呢
比如你创建新的一个什么
创建新的SLABEL方程嗯
然后呢接下来你要像什么
你要向缓存当中增加这个内存
又添加内存啊
或者是说你要实现消费缓存当中的一个什么呢
应用程序这些接口以及什么呢
以及这个sleep当中啊
对什么对对象进行分配和
分配和释放操作的这些啊函数
那么第一步一般情况下我们创建slab缓存
对不对
你看啊
比如第一步你要创建创建SLABEL缓存这个结构
那你怎么做呢
那你就直接跟这个来就行了
第一个你写上tractor conne嗯
tractor定义一下啊
k mm一个类型的k memory下划线
catch星号星号是什么呢
My catch
My catches
这个我们就创建好了
就是然后呢你这个slab缓存的一个函数
你就可以对它进行创建删除分配
就是KMEM这个结构体
注意啊
你要注意这个问题了
这个k mm catch
这个结构体开启这个结构体
它就包含什么
包含每一个中央处理器
就是中央处理器单元
就是我们所讲的CPU
CPU的数据全部在这里了
是不是
但是注意啊
一组可调整的一个参数
它是一组可以调整的一个参数
那么调整参数还包括什么呢
你要统计信息和管理什么
管理这些slab缓存
对不对
管理时代不缓存
但是这里所讲的一个什么
你说讲调整参数
调整参数一般在哪里面
你在这个PLC这个文件系统
我们就可以什么可以访问它这个结构啊
它设计是这样的好
那么现在我们掌握啊了解这个问题之后
那下面是什么呀
有这么几个函数
大家有点搞清楚
是不是
你看啊哪几个呢
第一个就是什么
第一个就是我们所讲的KMM下划线
Catch create
这是第一个哎
create这是第一个啊
哎这个是用来创建缓存的
要注意啊
啊这个是创建一个新的缓存
那么还有一个是什么呢
用来消费反串k mm下划线
catch下划线是什么呢
这地方是干什么呢
这里面就是消费消费方程
它上面是创建方程的
可以你看他这个来啊
还有一个什么
就是我们要什么
比如要从一个缓存重返再返程分配对象
就用到KMM下划线
catch下划线一个什么
The lock
嗯括号
这个怎么做呢
这个地方就是怎么做呢
就是分配缓存中
分配什么
分配对象
就这个意思
你要套起来啊
还有一些比如释放
比如KMM
下划线找一个什么catch
下划线frail
这些就是释放释放的对象
要注意
那么这些相关的IP函数
大家在实践操作当中大家多练一下啊
我们也有对应的相关参数啊
这个代码给大家进行应用
就是想什么呢
我们在这个LINUX内核源码分析这个课程里面
是给大家讲过了
是不是在哪里呢
大家可以看一下啊
在我们内核源码分析的这个课程里面
LINUX内核源码分析
这个源码分析
让大家更加了更加更多的去了解我
LINUX内核的一个底层原理
包括各大结构体如何进行应用
看到没有
总共加起来有94克是吧
94课里面呢
我们就会将什么将LINUX内核源码分析给它进行
分为这么几个模块
第一个模块呢就是我们要要学习的什么
你要学习的一个进程模块
这个第一个啊就是我们的进程模块哎
除了进程模块之后呢
那么接着我们就要学什么
要学内存
选内存
选内存之后呢
再写什么呢
在学这个网络
对不对
学完网络呢我们在学什么呢
学完网络再学这个啊
设备驱动
就是我们这个设备驱动程序
对不对
讲完设备性程序之后呢
我们再讲什么
再讲这个文件系统
文件系统讲完之后
我们在做什么
在做这个项目实战的一个案例分析
项目实战案例分析
那么大家一般情况下我们用的比较多
无非就是用内存
肯定这块用的比较多啊
网络这一块用的比较多
一般是用这两块是不是设备驱动
你做嵌入式肯定要比较多
你不做嵌入式肯定不多
文件系统
比如做存储这一块啊
分布式存储什么之类
那这个部分肯定是比较多了啊
哎进程调度的话
这个比较简单
最后就是项目实战
后面那个项目实战模块组是什么
主要是针对前面的这个什么五大模块
进行做一个什么
进行做一个实战的一个补充
让大家更加容易去理解我们这个什么LINUX内核啊
这就是我VIP的课程
那么今天晚上啊
这个内容我就全部都给大家分享的对了
有任何问题
到时候我们来进行进一步的沟通与交流
那本节课内容就到此结束
唉咱们下一次课啊再见

## 参考

[Linux内核《内存分配器与链表详解》_哔哩哔哩_bilibili](https://www.bilibili.com/video/BV1xi421o73f/?p=6&vd_source=4a018e55005b433dc9d72a8e969a1c5f)