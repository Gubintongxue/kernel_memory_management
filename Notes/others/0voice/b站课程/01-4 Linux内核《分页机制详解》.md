好的
那各位朋友们大家好
我是威克
这节课主要是和大家分享
LINUX内核当中的企业机制讲解
在讲解这个技术点之前
首先我们来看第一个大点一故障产生
以及他的一个错误定位
我们是如何进行操作的
那首先我们来看第一个页故障产生
他是怎么回事呢
首先就是说在LINUX内核当中
这个业故障碍它主要是指什么
指我们当前这个程序啊
比如他访问一个什么呢
嗯这个相当于什么呢
OK上位或者没有什么映射到这个物理啊
没有映射到物理内存的一个虚拟页面时
它就会发生这个什么错误的情况
这是我们要知道的
但是我们知道什么问题呢
有关于这个对应的这个页错误啊
比如这个常见的页数上
就包括了我们这个切页错误啊
对不对
就是你所需要的页面它不在哪里啊
不在我们这个物理内存
那你不在物理内存的时候
那这个时候就需要什么
就需要进行页面的一个置换问题
所以说我们知道这个常见的啊常见页故障
它就包括第一个就是我们经常讲的这个缺页啊
啊切页错误
这是一个点
因为你这个页他不在这个物理页面
那这时候你需要这个什么来置换页面
置换另外一个呢还可能出现这个页保护错误
一保护错误是什么意思啊
就是说尝试写入这个只读页面
这就是一写保护错误所产生的
还有一种是什么
你非法操作错误
非法操作错误这种情况
那么也叫做什么呢
也是常见的业故障所包含的范围内
那么当我们出现页故障啊
就是当我们发生这个页故障的时候
那么我们通过什么就是它的一个解决办法
怎么进行操作
解决办法比较简单啊
我们只要注意一个点
首先第一个比如一你要干什么呢
异常处理函数
它就根据我们所导致的一个什么
导致这个叫做液故障的这个原因啊
进行什么呢
相应的处理
这是第一种情况
我们可以这么做啊
检查一下
第二个呢内核检测内核如果检测到这个什么呢
液故障了
并且呢它就会将什么
将这个控制权直接进行
进一步转移到相应的一个异常处理函数
让它去解决
这是第二个办法
还有一个办法是什么呢
就是如果它是什么呢
如果是切页错误嗯
切错误的话呢
内核它就会什么呢
尝试从我们这个磁盘上面进行加载
一个什么相应的页面
直接到什么物理内存当中合成这种方法
并且呢我们更新相关的一个什么
更新相关的一个数据结构
这是第二个
第三个是什么呢
注意啊
一旦什么
就是相当于一旦我们缺页错误得到解决怎么办
那么得到解决的话呢
这个时候你的一个什么你的这个控制啊
就是我们相当于这个控制权要返回些什么
引起这个啊引起异常的一个指令
那么该指令他就应该什么呢
重新执行
所以他这个解决办法啊
就是你解决办法的一个流程
对不对
就在下面啊
首先第一个啊异常就对
这个写反了啊
不好意思
首先我们要检查这个什么内核啊
出现异常
如果异常错误一旦解决
对按照这个思路啊
刚才写完了
首先第一步我们干什么呢
内核检测到液故障了
并且将控制权转移到相应的处理函数
另外一个是什么呢
你这个异常处理函数
它会根据什么导致一故障原因进行相应的处理
然后如果是缺页错误
那么内核就会尝试从磁盘上加载相应的页面
到物理内存当中
并且更新相关的数据结构
最后就是什么呢
一旦我们这个缺页错误得到解决了
控制前一定要返回给引起异常的指令
该指令就重新执行
大家要明白这个思路啊
什么意思呢
总体来讲
在内核当中液故障它是一种正常
并且是必要的一种机制
用一个什么呢
管理我们虚拟地址和物理地址之间
的一个映射关系
确保有效这个使用系统资源
这是业故障的一个产生
那么除了这个问题以外的话呢
我们就来看第二点
第二点是什么呢
就是我们所讲的一个什么LINUX内核页故障
它的一个什么定位问题了
就是你要什么呢
要定位这个业务上的错误
我们应该怎么做
是不是
所以接下来第二个的话
就是我们了解这个问题啊
就是错误的一个定位嘛
嗯那这个错误定位是这样的
就相当于在LINUX内核当中
大家注意啊
就是
在LINUX内核当中当什么当进程啊
你访问一个什么没有映射到
等一下啊
跟上面一样
我就这么讲啊
当进程访问一个
没有映射到物理内存的一个虚拟地址
它就会引发什么
引发这个业务障
那么业故障引起业故障的啊
你拿自己和当中就是引起业故障引起业故障啊
有几种情况
哪几种情况呢
第一种刚才我们提到过了
叫做什么缺页异常时
其中的一种什么意思
就是这个页面它没有被加载到物理内存
那需要从磁盘或者交换空间当中进行什么呢
加载还有一个就是保护异常
为什么说保护异常呢
比如你访问那些被没有啊
就是你访问那些被精子页面呈现
那么他只读只读页面
进行什么写操作来保护异常
以及还有什么我们叫写实复制异常
写时复制异常是什么意思啊
就是说多个进程它共享同一个页面
并且其中一个进程呢
他尝试在这个页面什么写操作
那叫写实复制异常这个思路啊
思路的话我们一定要什么
一定要整明白啊
这才是什么最关键点的一个核心
OK好
那我们了解啊
关键点核心搞定之后
那现在我们就来看这个问题了
什么意思呢
就是比如我们要什么
你要定位这个业务账
对不对啊
他具体的一个什么步骤如下
怎么去操作
一步步来
首先第一步我们要查询查询这个错误的消息
怎么理解
它是这样的
就是你查询那个错误消息
是这样的
就说内核它通常会什么
打印出跟我们这个业故障相关的一个错误消息
这个时候呢它就会检查我们系统的一个日志
也可以使用什么
也可以使用这个d message
DMESG这个命令来获取那个长期信息
就是其中一种啊
就是当我们碰到页故障的时候
你打印信息的话
我们一般在哪里
比如这个系统日志VLOG下面的message是吧
这种情况
第二种的话就是什么呢
就是我们使用这个工具啊
使用工具进行什么分析
使用工具进行分析
那我们用的比较多的啊
你比如什么GDD啊
调试工具是吧
说GDP呢还有性能分析工具是吧
还有f trans这些啊等等
那我们通过这些来什么呢
来跟踪
通过它来跟踪和调试程序的一个执行过程
那就这么一个思路
大家一定要整清楚这点就行了
这些工具啊
它能够帮助我们来分析和捕获
那个业故障发生的时候
B站的跟踪信息
还包括一些寄存器啊啊啊都可以把它调试出来
这就是第二个第二步
那么第三步就是相当于什么呢
这个时候我们就要检查一下内存管理机制了
什么意思
就是LINUX内核内存管理啊
他负责处理页故障和一些虚拟地址和物
理地址的映射
那么LINUX内核管理机制工作原理和算法
可以帮助我们
能够理解这个业务的发生和处理过程
还有一种情况就相当于什么呢
我们就直接什么
就直接分析这个代码的逻辑关系了
分析代码逻辑关系
那可能有一定的变强了这个开发能力了是吧
就是说如果啊比如比如什么呢
比如有访问内核源代码的权限
那我就可以通过检查这个代码进行
进一步来分析一下
特别是我们要做那些啊啊分配啊
视放啊
页面映射啊
这些代码段很容易出错
是不是总体来讲这个页故障的错误定位
一般情况下啊
各位同学们要注意就是越故障定位要什么呢
要结合第一个就是系统的日志是一方面
还有呢要结合什么呢
结合相关的调试工具来解决
以及什么对我们内核源码的一个什么理解
进行综合分析
我们要做到这一点
这样的话才能够定位这个粗点在哪里是吧好
那我们搞清楚啊这些相关问题之后
那下面的话呢大家可能要注意什么
注意另外一个点就是LINUX内核当中
它能够引起这个什么缺页异常
你看啊
嗯缺页异常什么意思
缺页异常刚才讲了啊
就是当程序访问一个没有映射到物理内存
虚拟地址
就会发生缺页异常
就是说当这个缺页异常刚才讲了啊
当缺一异常它发生的时候
操作系统怎么做
首先你这个操作系统的话
它就会什么
刚才讲了啊
操作系统它就会检查
引发缺页异常的一个什么虚拟地址
这个看一下这个虚拟地址
是否有对应的内存映射
这一点我们要整明白
是不是不行
就不出了
什么意思呢
缺异常
当发生切异常时
就是相当于我们这个操作系统啊
他的一个什么嗯
通过如下的这个步骤来解决
哪些解决呢
第一个就相当于这个操作系统
你就一定要什么
一定要检查一下他这个引发什么呢
引发缺页异常的一个虚拟地址哎
它是否有效有效
并且要什么
并且有对应的一个什么内存映射
就这个意思就是他处理这个步骤是吧
嗯第一步搞定之后
接下来什么
那那如果是不是就相当于什么呢
假设假设你没有什么
如果你没有有效的一个映射
这个时候操作系统啊
它将为什么将为此页面嗯
分配一个什么物理内存
并且你至少要建立一个什么
来建立一个虚拟地址和物理地址之间
的一个什么映射关系
这是第二步
你要做的
第二步做完之后呢
第三步
那么如果什么呢
如果此页面啊
他已经什么呢
被交换到这个什么磁盘上面了
磁盘上了啊
此时你这个操作系统啊
就要将什么将从这个磁盘上面读取什么呢
读取页面到读取页面数据了
并且加并且嗯加载到物理内存当中
就这个意思
这是第三步
那么最后的话呢
操作系统嗯它会更新这个列表了啊
以反映一下什么
反映一下新的映射关系就可以了
并且他会重新执行所引发的一个什么
缺页异常的一个指令
你看他就按照这个步骤来解决
这样的话呢
程序它就可以继续正常运行了
并且也也能够所需要的
并且所需要的一些数据啊
它也能够正确的加载到物理的层面去了
就按照这个办法来解决就可以了
这是我们要知道的
还有一个什么呢
还有一个我们掌握的
尤其在写代码过程当中分析的时候
我们如何进行什么实现这个保护异常
什么意思
保护异常他是这样保护我写错了
不好意思啊
这个保护异常保护异常什么意思呢
它主要是什么
它主要是指通过这个异常处理机制来什么
来来保护我们这个系统啊
就这个意思啊
异常处理机制来保护系统的安全性
系统安全性和对应的一个什么稳定性
什么意思呢
就是当你发现这个异常的时候
假设这个内存访问错误了
或者我们经常讲的一个什么非法指令执行
所造成的一些错误
这个时候操作系统呢
它就会直接从来进行进一步捕获这些异常
并且进行什么相应的处理
它就这么一个思路啊
那我们在学的这个过程
当中大家注意啊
LINUX内核它使用一种叫什么叫做异常向量表
因为这个异常向量表它可以怎么样呢
它可以保存啊
可以保存我们那个什么呢
就是专门一个数据结构来管理这个异常
这个表当中啊
它就包含了每个异常对应的一个什么处理函数
包括你处理程序的一个入口地址啊
它都会什么都会包含在里面啊
这个是完全没有问题
是不是大家要搞清楚这个点就行了是吧好
那么当发生异常的时候
硬件呢它会将什么
会将这个控制权转移到对应的一个什么
异常处理程序上面吗
并且它会执行一些相应的操作嗯
来确保你出现问题的时候
操作系统呢能够响应
采取适当的措施
防止我们这个系统马上挂掉
或者受到一些恶意的攻击
是不是
所以说我们通过这个保护异常的机制
LINUX内核它这个啊可靠性安全性他就得到了提高
能够保证我们系统
系统在非常恶劣的环境下进行什么正常运转
所以说是我们要知道的这个问题是不是好
那我们现在了解这个之后呢
接下来我们看一下是不是在做什么呢
嗯下一个就是我们经常讲的一个什么
提到的叫做写实复制异常
写实复制异常
诶刚才我记得给他讲过了
写时复制一场
对对对
这个写实符刚才讲缺页异常保护异常是吧
还是写实复制异常好
我们来看下一个第五个
写时复制异常什么意思
就是写实复制
我们叫做CORE c o w r copy on wr
它是什么呢
它主要是指什么
它是内存管理
内存管理当中的一种什么技术
对不对嗯
它的原理是什么意思呢
原理是当多个进程啊进行什么呢
共享同一个资源
同一个资源
比如内存页
共享同一个内存页的时候
只有什么呢
只有当其中一个进程或者啊啊尝试了嗯
一个进程试图去修改此资源时
他才会怎么样呢
才会进行实际的一个复制操作
主要目的还是要怎么样呢
他要确保你这个每一个进程都能够什么来获取
独立的一个副本
他来干这个事情
关于这个显示复制异常
就是他不确定什么呢
你具体指哪一方面
就是说如果啊如果显示异常而显示复制异常
可能会出现在什么情况呢
比如出现哪些地方啊
内存有内存分配失败啊
他对我不好意思
我写错了
写实
嗯比如你分配内存失败
它可能就出现显示异常了
还有一种就是权限错误
它也会导致显示复制异常
或者你没办法接什么执行这个写操作的时候
就会出现这种写实复制异常啊
那就是说我们在研究的时候
大家一定要注意啊
在某些场景下是不是用不到的啊
就是相当于什么呢
相当于这个在我们这个LINUX内核当中
对不对
你这个写实刚才讲了啊
叫做写实复制异常
它所产生的一个环境
我们一定要什么
一定要把它搞明白就行了
是不是杠
那么它产生写实复制
它就是相当于什么呢
它就相当于我们这个就是延迟复制的一种
技术当中啊
就是用在什么呢
用以多个进程共享一个内存页手诶
它能够实现那个什么高效管理
当一个进程
它尝试修改共同的一个什么
共享的一个内存页时
就会触发这个显示保护异常
他他那个思路是这样的
是不是
所以说并且它会触发那个血保护异常
那并且进程呢就分为进程
分配一个什么新的一个副本嘛
为了分配新的一个私有副本
这样的话他就可以什么不必要再复制操作一遍
它也能够什么呢
同时也能够提高我们这个效率
这就是他要干的事情
是不是
所以我们也要搞清楚它的原理
到底是怎么回事是吧
那我们了解他那个语言你怎么回事之后呢
但是你要注意在整个操作过程当中
他有这么几个点啊
你看就相当于什么呢
在我们这个LINUX内核当中写时
复制异常就是他的可能啊
可能
产生可能产生的情况在哪些地方
比如第一种情况叫做共享库加载
那为什么说共享库加载
它可能会产生一个写实复制异常呢
他这样的
比如你多个程序同时加载
并且使用一一样同样的库
相同的库
他们就会共享相同的一个物理页面了
那如果其中一个程序哎
他要修改这个页面
他就被触发了一个血保护异常了
就触发血保护异常
就触发了血保护异常
就这个意思就是啊对
就是说他触发了个鞋保护异常啊
为什么呢
程序创建了一个副本
就这个意思
除了这个共享库加载以外
你还有一个写保护映射呢
嗯写保护映射是什么
意思是说他通过那个内存内存映射区域啊
IMAP是不是他就可以什么将那些嗯
这些页标记为比如可写的或写保护了
或者是可读的这种啊
只读的
如果尝试修改
卖一些标记好的页面
那如果你去修改它的话
对不对
你修改那些嗯刚才讲的那个标记只读啊
或者是写保护的
他就会触发那个写保护异常
就触犯你的血保护异常
就这个意思
还有一个
比如父子进程可能会产生父子进程
父子进程是什么意思呢
就是说比如我们在写代码的过程当中
我们经常会出现这么一个字
看下fork的时候退出
让我们来看一下
你看啊
退出相当于什么呢
为什么说父子进程
比如当附近层进行什么
附近层进行唉fork创建一个什么呢
紫禁城的时候
默认情况下紫禁城跟附近城啊
就是你创建了个紫禁城跟什么
跟我们说叫附近城
唉他们两者之间就会什么
两者之间它就会共享一个页面
营业公司它紫禁城共享这个页面
附近城它也共享这个页面
就是共享相同的物理内存页码诶
那如果什么呢
如果其中的一个进程要修改音乐
比如啊比如你附近层
对不对啊
附近层你要去修改这个啊页面的话
如果你要修改这个页面的话
那么他就会触发什么
触发这个血保护异常
那它就自动会为什么
自动会为你这个进程那个页面诶
再给你再给怎么样呢
再给你创建一个副本出来
就这个意思就这么个思路来搞清楚好
那么当这个整体情况下
就是当这个进程呢
他试图去修改这个共享内存页面
LINUX内核通过写保护异常机制触发写时复制啊
不管写时复制的话
那么就为什么呢
为我们进行创建一个私有的副本
这样的话大家可以研究一下
是不是这就没问题了是吧
好大家搞清楚了
我们给大家讲解一共有什么呢
五个小点页故障产生及定位页故障怎么产生的
对不对
错误定位怎么去操作
步骤怎么完成是吧
当中我们要知道引起业故障有什么呢
缺异常的时候怎么处理
保护异常是怎么回事
写时复制异常是怎么回事
好那接下来我们就来看本节课当中的第几点
第二点第二点我们要讲的是什么
就是进程地址空间缺页异常处理
什么意思
刚刚我们讲了在LINUX内核当中啊
你看好在LINUX内核
这什么呢
当然这个进程啊他访问一个什么呢
没有映射到物理内存的一个虚拟地址
虚拟地址时
这个时候他就会触发什么呢
触发缺页异常
对不对
那么处理啊
注意啊
你处理这个流程
你怎么去处理的
处理流程它是这样的啦
第一个就是相当于什么缺页异常
他的一个什么触发
OK缺异常的住房
好我们可以想一下
当一个进程他访问没有映射到物理内
物理内存空间的一个物理内存的一个虚拟地址
这个时候CPU就会产生一个什么
产生一个缺异常的一个处理信号
就是产生一条啊缺异常的中断信号
你传中断信号之后呢
这个时候LINUX内核中断处理程序就被触发了
是不是啊
这个时候CPU它就切换到内核模式
他把那个控制前交给对应的一个中断处理层
信息处理啊
这里的话就是我们所讲的缺页中断处理程序
你触发它才要以不触发过的电码
嗯下面的话呢第三步的话
你这个异常处理程序他就去执行啊
就去执行
那就是缺异常处理程序
首先要检查你这个虚拟地址嗯
有没有是否有效或者是否是合法的啊
如果你无效或者不合法
我就终止你这个进程
如果合法并且有效
哎我就进行什么
下一步操作是下面第四步的话就是什么呢
就是我们所讲的一个页面分配
页面分配什么意思
就是说如果虚拟地址对应的页面没有被分配
那么权益常数程序就为它分配一个物理内存
分配啊
分配一个页面的物理内存了
并且建立一个虚拟地址和物理地址的映射关系
就可以了
那么你创建完这个创建完那个物理内存页之后
那你要干什么呢
下面你要把它加载起来了
就是页面的加载问题了
页面加载什么意思
如果虚拟地址对应的页面已经被分配了
但是他没有从磁盘加载数据啊
那全异常储存器就通过那个调度器啊
把那个页面所属的文件从磁盘读取到物理内存
就是它的一个过程
完了这个页面加载之后呢
后面就有你就要更新页表了嗯
那为什么要更新列表呢
因为你完成页面分配和加载之后
缺异常处理程序
它就会更新更新这个进程列表
更新进程列表
它的目的是将什么呢
虚拟地址跟新的分配
或者是加载的物理地址进行映射
更新列表就这么一个思路啊
最后的话呢你就会怎么样呢
他就会重新执行
重新执行所引起的一个什么叫做缺页异常
出入啊
缺异常的一个指令
你看他就按照我这个思路来完成就可以了
对不对
那么最后一步呢
处理程序把那个控制权交给用户进程
并且呢执行一些什么
并且重新执行引起那个千叶异常的一个指令嗯
最后会正确些什么呢
最后他就会得到什么
你这个访问操作啊已经成功了
他就这么个意思啊
所以说LINUX内核它能够有效的去处理
我们这个进程空间的一个缺异常
尤其是什么呀
尤其是我们刚刚所讲的那个什么上面的
这几个过程
它能够什么呢
能够保证我们这个进程它能够在什么
在这个对应的一个虚拟地址啊
在和那个物理内存之间能够什么呢
正确的映射出来
这是我们要搞清楚的一个点好
那我们搞清楚这个问题之后
那么接下来我们就来看下一个了啊
OK好
那么下一个是什么意思呢
下一个他这样就是说相当于什么呢
我们LINUX内核它有一个什么请求啊
请求调页和写实复制技术
那刚刚我们提到了一个点
我们就不再列举了
现在我们来看第三点
第三点请求调页就是相当于在LINUX内核当中
内核当中
那你这个请求调页
请教业呢它也是什么
也是一种内存管理技术
这是什么呢
它能够允许它允许这个操作系统
会将那个进程的部分的进程
部分的一个什么虚拟地址空间进行什么
加载到物理内存当中
就这个意思
并且呢它只有什么
只有当我们那个进程啊
真正需要使用这些页面时
它才能够进行什么加载
对不对
但是要注意啊
这种延迟加载方式
它可以什么来减少这个内存占用和启动的时间
嗯就是这个那第二个写实复制刚讲了啊
写时复制的异常不一样啊
写实复制它也是什么呢
一种内存管理技术就是主要目的是干什么呢
优化这些共享资源的一个复制操作
共享资源的一个复制操作
就是我们再提一下啊
当什么呢
就是当进当很多个进程或者很多个县城
你要同时访问一个资源
那么初始化的时候
他们就共同就是相当于共享一个同一个副本了
那么其中一个进程就要修改这个资源
那就会触发那个写实复制机制嘛
对不对
所以操作系统呢它就会创建这个资源的副本
它并且呢啊仅被修改操作进行什么实际拷贝
其他进程
它仍然来共享原石那个副本
这样的话可以节省节省开销
提升的性能
多任务环境下就更好了
那就是这种方法写实复制好
当我们了解这个写实复制之后
接下来我们来看本节课当中的第四点
内存检测以及什么呢
死锁检测的方法
同学们看第一个啊
就相当于什么呢
比如我们在这个
在LINUX内核当中嗯
我们使用什么
如下的这个方法
来检测我们内存的一个什么问题
检测内存问题哪些呢
第一个我们可以通过内存泄漏工具
检测工具来完成这其中一个啊
你比如内存泄漏检测工具有什么VLOG是吧
value greed这种这个工具是吧
除了这种工具的话呢
我们可以使用叫什么SK或者是ELSK啊等等
但我们是通过这些工具关注我们检测
应检测那个程序啊
你写了个代码程序是不是它内存泄露问题
因为这些工具呢他可以怎么样呢
他可以更新
要注意啊
他可以就是可以跟踪跟踪分配
和释放内存的操作
并且还包括那个没有释放内存在哪个地方
他这个工具调到另外一个呢
我们可以什么呢
就是直接使用了这个系统
直接使用系统自带的一个工具
系统自带工具是什么意思
就是LINUX内核调试
LINUX内核调试的话
它一般是什么呢
一比如啊嗯
比如我们是在PLC目录下的
这个是PLC目录下方有一个什么m e m information
你可以什么
通过这个来查看系统的一个什么内存使用情况
他可以做这一点
这是第二个是吧
还可以什么呢
你还可以通过PLC
比如啊你PLC目录下面就有一个p i d maps
也可以查看进程空间的一个什么映射情况
除此以外我们可以有有一个什么叫做调试器嗯
debug调试器
这个调试器啊
就像这个GDP一样
调试可以帮助我们定位内存相关问题
它可以通过代码的设置观点
比如监视某一个变量
包括一些访问地址的变化
随时可以什么追踪和调试内存的错误
另外一种的话呢
最后一种我们可以通过什么
通过静态代码的一个什么分析工具
静态代码分析工具
你比如用的比较多的了
无非就是cpp check
这个就是用的比较多的
除这个的话呢
一般是用这个的
我就不再解很多了
OK那么通过这个工具我们可以什么呢
我们可以对这个语言代码进行什么静态分析
比如他呢他这个工具可以识别什么呢
潜在内存问题
比如你在写代码的时候
他有个警告
对不对
警告其实他也是错误
是不是
如果他没有暴露出来
不妨碍我们运行
但操作过程当中他随时可能会爆发
就这么一个思路
大家了解这个这个点就可以了
是吧啊
这就是有关于什么内存检测
是不是还有一个什么呢
还有一个就是我们所讲的一个死锁检测方法
你看啊
这是第一个
好现在我们来看第二个
第二个是什么呢
死锁检测
死锁检测方法
死锁检测方法
这样就说在LINUX内核当中只有这三位一种啊
它主要是指什么意思呢
就是比如你多个线程
多个线程或者是多个进程嗯
进行什么来进行相互等待这个资源
而无法继续执行的一个状态
这叫死锁
对不对
所以说我们解决这个死锁问题
按法比如第一个你可以通过工具啊
你比如死锁检测算法它也可以
是不是就可以解决啊
实时检测上发什么意思
你比如这个LINUX内核及资源分配啊
资源分配图
你比如这个叫银行家算法的这种啊
进行实时检测
它也可以啊
这个算法是通过什么建立资源分配图啊
并且对这个
对他对这个资源进行什么循环依赖检测
判断它是否存在死锁
所以大家要搞清楚啊
我们叫做什么银行加双方就操作
下面讲啊
银行家这个算法在这里是吧
我们要整明白就行了
Ok
等一下啊
啊那有的啊
除了这个嗯死锁检测算法
银行家以外
那么还有一种方法叫什么
还可以通过工具就是死锁死锁检测工具
死锁检测工具
就是这些工具来帮助我们检测出问题
你比如说工具
比如用到什么呢
这些什么lock是吧
LOCLOCKD啊
looked up就是在什么呢
在编译内核的时候就启动了
并且能够动态来检查我们潜在的搜索问题
另外一种方法
我们就可以通过什么来
通过内核配置的选项来解决
哎这种方法啊
就通过内核配置选项
这也是一个办法
内核配置选项
主要是给我们这些工程师考试和定位死锁问题
比如你设置一些参数啊
来进行什么
来增加对内核锁的一个什么监视和验证
除了这种情况
我们还可以通过什么分析日志信息
分析日志信息是什么意思
就是说当出现死锁的时候啊
我们可以通过查看那个系统
系统日志来获得那个呃错误的信息是吧
思索的信息
也包括日志所包含的一些线程进程或者被阻塞
导致那些原因
我们可以分析的出来
基本上它整个操作的思路他就已经告诉了我们
是不是
所以说刚刚我们所提到的
大家也可以什么有时间你可以研究一下
研究什么问题呢
刚刚提到了嗯
刚才提到了一个什么问题呢
就是我们所讲的那个银行加算法
什么意思
我写到后面
大家可以观察一下
相当于什么呢
银行家算法
银行家算法它是一种什么
专门用于什么呢
专门用于避免它就是避免死锁
避免死锁的一个什么资源分配算法
所以说包含在操作系统的应用
也包括LINUX内核都在用它是不是
那么为什么是这种呢
因为银行家算法系统
它就会维护每一个进程的最大资源
的一个需求量
比如已经分配的这个资源量啊
包括啊啊或者和一些仍然需要资源量的那种
就是当这个进程啊还请求分配额外资源的时候
系统就先判断一下是否存在足够的这个资源
能满足那个这个进程的一个要求
是不是同时要保证什么呢
你这次分配不会导致这个什么系统
它陷入一个什么僵局
陷入一个死锁
所以说LINUX内核实现这种机制
来支持银行加这种算法
或者类似于什么策略来管理资源分配
避免死锁
比如我们那个进程调度是吧
那么这种机制银行家算法的机制
比如它包括什么呢
包括你这个进程调度
它通过调度策略啊
能够有效控制对共享资源的一个访问和使用
它可以减少食素的发生可能性
还有一种就复制所了
复制锁它就提供什么同步联谊啊
比如复制所在共享数据的时候就加锁操作
保证数据的一致性
在不在需要的时候去释放这个锁啊
适当的使用互斥锁
可以帮助避免这个发生冲突
失锁啊
还有一种就是资源管理的资源管理
就说内核他通过跟踪啊
这个进程占用了一个资源数量啊
根据实际分配和释放内存
这种是动态资源管理机制
避免资源过度的分配
这样的话他也可以减少死锁的一个风险
就是按照整体的这个什么呀
要求的话
就是银行家算法
它在内核当中体现在什么呢
就资源管理这一块这一块包括进程调度是吧
还同步运营这方面
那么如果我们能够非常合理的去分配和控制
这个系统之间使用的话
也能够有效预防和避免这个时速
所以我们要搞清楚这个问题啊
这就是我们本节课当中的第几点呢
第四大点好了解第四大点之后
接下来我们就来看本节课当中的第五大点
那么我们的第五大点主要是实现什么呢
大家注意啊
LINUX内核啊
在常见的一个技术面试题
那是因为什么呀
因为我们很多啊这个同学在面试过程当中
他反馈出来了
在这里的话我给大家整理出来啊
LINUX内核以100道面试题
那比如第一第二第三是不是一直到后面啊
那么接下来什么呢
接下来我就真的很没有答案呢
我就给大家一一的进行讲解一下
后面这些是有答案的啊
这有些事还没有写出来啊
那现在有些有有些没有啊
好那现在我们就来看第几个了
第14个
那么第14个CMWQ机制
它是如何进行什么呢
动态管理
我们这个工作的一个什么线程池的线程
他是怎么处理的
那我们在学这个的同时
大家知道在LINUX这个它是什么
LINUX内核当中
动态管理工作线程池的一个机制
它是一种动态方式啊
管线层次
那么它比如主要是主要目的是什么呢
你看参考答案给你个主要的目的
主要
主要目的是用于什么呢
调度和管理什么多个任务啊
或者是什么呢
多个工作队列
他的目的就在这个地方
是不是啊啊那当我们了解他这个目的之后
那后面我们就好办了
后面怎么样呢
啊你看啊我们是通过什么呢
我们通过嗯如下的一个什么方式
如下方式动态管理这个工作线程池的一个线程
你怎么去管理呢
第一个就是我们通过这个工作队列
工作队列什么意思
工作队列啊
我们就使用了一个什么呢
works correstructure来表示一个工作队列
然后包含里面的执行工作项以及相关的属性
还有一个什么呢
你是如何进行什么创建和销毁的是吧
创建小伙们通过函数创建一个新的工作队列
如果不需要找我们destroy就可以了
这些函数会自动的
什么为工作队列进行创建和释放这个什么啊
一一定数量的一个什么相应数量的工作线程
除了这种方式
我们还要什么
还学会这个叫做什么调度策略
调度层面调入创建是怎么回事呢
大家注意啊
就是他通过这种这种机制
它是基于什么
它是基于红黑树的调度策略来解决什么呢
来决定什么时候启动和停止这个工作线程
比如当一些当有新线程
工作项被添加到队列的时候
哎
它就会根据那个负载情况
决定是否启动更多的工作线程
来处理这个任务唉
当任务处理完毕之后
空闲的一个呃
就是空闲的一个状态
现在他可能被暂停或者是终止
这样的话可以节省那个什么
节省这个系统的一个资源数据信息
另外一个的话呢我们可以优先调整优先级
调整什么意思
优先级的人就说这种机制
根据优先级对不同的任务进行区分和调度
我们可以设置一些合理的一个什么优先级
确保更高优先级图
它可以更高的响应这个系统资源
他就按照这个思路进行完成
所以你在解答的时候
你要按照刚才我提供个思路进行来搞定好
这就是我们所讲的第十几个了
第14个
那接下来我们就来看第15个对吧
第15个什么意思呢
你看啊使用GCC的啊
O0优化项优化选项来编译内核
由如何优势就是相当于什么呢
你有哪些优势啊
嗯那么它有哪些优势呢
大家注意一下啊
因为什么
因为你这个使用使用GCC这个O0杠O0啊
它是什么意思呢
比内核它有几个优势
第一个优势它就相当于什么
相当于进行简化了啊
简化这个调试哈哈J
那老师为什么是简化调试呢
简化调试就是说我们所用就加一个参数了
就是杠是不是
OK比如你杠O0的时候就相当于什么呢
这个选项它就会关闭了
对不对
这个选项它就相当于关闭的一些部分东西了
相当于关闭大部分编辑的优化功能
生成了一些代码资源的一个代码
结构和顺序保持一致
这能够让我们调试内核的这些更加的简单
也可以方便地进行什么呢
单步调试或者查看一些变量值
就是减少这个问题
除此以外还有一个什么呀
还有一个就是你了解代码的可读性比较高
是为什么呢
生成代码
它保持这个语言代码的一个顺序和结构
它不会被什么复杂的优化技术改变
嗯这是一方面
另外一方面呢我们可以什么编译啊
编译速度比较快
是不是啊
为什么说编译速度快呢
比如你关闭了大部分的优化
说它不优化了
所以编译时间就会缩短
是不是
所以在开发过程中
频繁使用这个重复编译情况下
它可以节省节省很多时间
这是一个
还有就是我们用这个杠啊O0的时候
它可以提供一个什么详细的一个警告信息
就这么个意思
什么意思呢
冰系啊会通过提供全靠信息
来帮助我们开发人员啊来解决或者是分析
或者是发现这些潜在的错误或者潜在的问题
就这么个意思
但是我们必须要知道
你像杠双引号
双引号杠O0是吧
它主要是什么呢
这个选项用在哪些地方
这个选项啊它主要是什么呢
主要是适用于哪个阶段呢
第一个是适用于开发阶段
还有一个是调试
调试这个阶段还有一个就是用于测试阶段
就是用的这三个部分
调试阶段
开发和测试阶段就可以了
这是我们大家啊要知道的一个问题
好那我们搞清楚第15个字号啊
那接下来呢我们就来看下一个下一个啊
这个是汇编呢是吧
都简单
大家看一下啊
好我们来观察一下什么意思
什么是直接寻子
什么是间接性质
什么是机子性子这么几个问题是吧
那么有关于我们只要什么
只要大家学习过这个什么呢
汇编语言的方言
那么对于这些问题我们就更加的简单了
也更加容易理解它
否则的话你就不好理解了是吧
OK那首先我们来看一下
再来观察一下
比如我们经常讲的一个什么呢
这个直接
好直接停止
直接停止
就是我们最常见啊
直接性质为
为什么呢
最常见最常见的内存寻址方式
那么他怎么样呢
他直接使用这个指令中的一个什么
指令中所给出的一个地址
直接来访问内存中的一个什么数据或者指令
这种情况我们把它叫做什么
叫做指令错了
好意思
指令嗯
那么这种情况就是指令
它就包含了我们要访问的内存地址本身
比如啊比如我们在写汇编的时候
比如木是木什么呢
比如阿比如R1
是不是后面我就给一个地址了
这什么例子
0X是吧
0X的话呢
比如0000FFF是吧这些
那其中我们就知道了
有关于这个问题的话
比如0X4个0F是不是
其中0X4个零四个F的话
这一块是什么呢
就是我们要访问的内存地址嗯
大家搞清楚是吧啊
这是直接啊
直接寻址
我写错了
直接寻址这种方式就是最常见的形方式啊
他直接使用指令中给出的一个地址
来访问这个什么内存中的数据指令
就这个意思啊
这是其中的一种
另外一种是什么呢
我们看一下我们把它叫做什么间接性质啊
别着急啊
间接性质
Ok
间接行止是什么意思
间接寻址呢它主要是指什么
直接寻址
坚决行词是指指通过什么
通过一个间接的一个什么继承线啊
间接寄存器或者一个什么呢
内存单元
来获取我们最终啊要访问的一个什么地址
这种情况就叫做什么叫做间接性质
就是通常是什么呢
比如我在在指令当中
我给出一个寄存器
我给你一个寄存器作为间接性质啊
就给一个寄存器作为一个间接地址
那寄存器当中保存实际要访问哪一个内存地址
你比如我举个例子啊
还是以木这个指令为准是吧
比如我前面写的什么啊
三对不对
逗号
然后中括号限号是R2
当大家所看到这条指令的啥也不太清楚
是不是起手
我告诉你啊
R2它就是个寄存器
这个寄存器呢它就保存了
要实际保存了
你要读取写入的一个内存地址
它并不是直接给出你这个啊明面上例子啊
通过这个来保存
就这个意思
这种方式我们这个什么间接选用符
除了间接性质以外
我们还有一种情况是吧嗯就是叫什么呢
叫做机制性质
机子性质
机制形式是什么呢
就是它主要是指通过什么
通过加上一个什么基准值来计算
我们最终要访问的一个什么地址的一个方法
这个我们叫做什么叫机子性质
在机制行止这个方法过程当中
那我们就需要什么
需要你先第一个你要给出一个寄存器啊
计算至少你给出个机子计算器
还有就是你要给出一个偏移量才可以
否则就不行啊
然后呢你把两个两个两者之间加起来
就最终就会得到你要访问的内存定制
那现在我们看一下
我觉得非常简单
用木是木空格
然后呢比如写个R3R3逗号
我中括号里面呢
比如现在是R2嘛
R2再加上这个介值性就不提出来吗
R是比如说就叫做介子寄存器
然后呢R2叫机子寄存器
比如我后面加个0X0X这个
H56是吧
就这个好
当你看到这个的时候
你肯定明白这个是提供了机子继承器是吧
后面呢你XH56呢它是属于什么呢
偏移值偏移量是不是就是执行两者
就是你要把两者
把这个机子寄存器里面
只跟这个0XH56加起来
才会得到什么最终的一个什么内存地址
所以我们要搞明白这个点就可以了
OK是吧
这就是所以你要搞清楚啊
什么是直接
什么是间接
什么是机制
这三种性质方式嗯
我就全部给大家打出来了是吧好
那么接下来我们就来看哪一个呢
来看下一个了
下一个是什么呢
比如我们在什么呢
你在X8664架构当中
木指令跟LEI指令它有什么区别
那这个也是有关于什么
这个它也是有关于为汇编的问题
有关于汇编问题
好注意啊
在这个什么呢
在就是在X8664架构中
对不对
两者的一个区别嗯
两者之间的一个两者区别了
这两者有如下的区别
哪些区别呢
比如木算木
木是讲过啊
木是什么意思啊
目非常简单
它是将什么
将一个值从一个位置复制到另一个位置
从这个位置附到另外一个位置
就是木屋来干的事情
什么意思呢
这个木啊它是用于什么
它主要用在什么
用在这个寄存器之间的一个什么数据传输
就这个意思啊
但是呢它也可以使用什么
也可以用在这个内存啊
和寄存器之间的一个数据传输
就是它的一个特点
那么木子令注意啊
木这个指令它可以什么呢
他直接将这个什么言操作数
言操作数它的值复制到目的就是目标了
目标操作数的对应的一个什么位置
他可以做到这一点嗯
这是我们大家要知道的这个木是吧
那如果是什么呢
如果是LEA这个指令是怎么回事
LEALEA它主要是用在什么
主要是用于这个计算地址的啊
计算地址而不是什么呢
而不是这个进行什么实际的一个数据传输
这是两者的区别是吧
大家注意啊
LEALEA指令它会加什么
来将一些有将这个有效地址
有效地址就是我们讲了一个什么有效地址
就是内存地址进行计算出来
并且呢来把它存储在什么目标操作数当中
但是它通常是什么呢
通常主要是用于什么进行一些嗯
相当于进行一些相当复杂的一个
什么地址计算呢
也可以用在这个结构体成员的一个
什么偏移计算
以及包括什么嗯
电子计算结构体成员偏移才用到
还有一个就是相当于什么呢
比如奥数组数组也会用到数组索引等等啊
这些都可以看得到
这就是有关于什么
有关于我们所讲的X86架构目跟什么
跟这个LEA它两者之间的区别
哎我全部都给他讲了
那接下来我们就来看下一个了是吧
下一个是什么呢
我们经常讲的一个死锁啊
要注意啊
什么是死锁啊
什么是重定位
实属有哪些是有哪几种
其实有关于这个定位啊
刚刚我们提到过是吧
你看
好我们来看一下嗯
什么意思呢
首先第一个问题
我们看那个死锁问题是吧啊
死锁死锁其实刚刚已经讲过了
它相当于什么呢
就是指在什么
就是相当于并发系统当中
对不对
比如你两个啊
或者是多个这个或者是多个进程啊
或者是多个线程
多个进程
多个线程啊
嗯嗯相互的相互等待对方释放
嗯对方释放资源啊
无法什么来继续
无法继续什么执行的一种状态
这就叫做实数
简单的来讲
概述来讲
就是说多个进程或者多个线程
没办法满足彼此这个资源的需求
就能出现失速
就这个意思
还有一个是什么叫做我们这个什么重定位
重复定位是什么意思
另外我看一下啊
重定位是这样的
它主要是指什么
就是指将什么呢
它将一个程序或者将一个进程从一个什么
从一个内存地址空间进行什么
移动到另一个内存地址空间的一个过程
这叫做重定位
什么意思呢
就是在计算机这个操作系统当中
程序和数据我们就把它加载到内存中执行了
当程序被加载的时候
那操作系统呢
他就需要决定
将你这将它放在内存中的哪个位置
并且进行适当了啊
地址修改啊
这种操作是不是要重定位
就是将一个程序进程
从这个内存地址空间
移到另外一个内存地址空间
这种操作就这叫什么
这就是写错了
不好意思
不是进程
是过程嗯
就从一个内存地址
把进程或者程序
从一个内存地址空间
移到另外一个内存地址空间的过程叫重定位
好了解之后
那么下面还有一个问题
我们这个什么叫实数
别着急
死锁死锁在一个什么死锁类型
对不对啊
有哪些思索呢
我举几个常用的啊
第一个是副词条件的一个什么思索
什么意思
复制条件实时就说多个进程线程
它同时去访问那个什么呢
同时请求共享资源
并且这个资源你只能只能有一个进程
占用的时候发生
这叫这叫副词条件的思索
还有一种叫什么呢
就是不可剥夺
做了一个什么思索
什么意思啊
不可剥夺的一个思索啊
不可剥夺死锁是什么意思
就是说已经分配给进程的这个资源唉
不能被其他强制性霸占
这叫不可剥夺的思索
就这个意思
还有一种叫什么呢
叫做这个词有变化时就啊对
还有一种嗯我讲常用的啊
比如循环等待死锁
循环等待思索什么意思
就是说比如你有有有很多啊
有一组有一组进程
形成一个什么循环链式的一个等待啊
等待其他进程啊
所持有所拥有的资源
这叫什么循环的次数
哎他就可以按照这个来是吧
好那么了解第18课之后
接下来我们就来看下一个啊
第19个我们来观察一下
一个一个来是吧
什么是异形地址
什么是链接地址
什么是加载地址
有关于这些问题
那我们得好好的去研究一下是吧
其实你要注意啊
这个并不难
你看第一个第一个是什么呢
硬性地址
英雄地址我们叫run time address是吧
U型地址什么意思呢
就是英雄地址在哪也叫做什么
也叫做虚拟地址
或者或者或者把它叫做什么
叫做这个逻辑地址
就这个意思是不是它是什么呢
它是我们程序在内存当中实际执行的时候
所使用的一个什么地址
这就叫做什么运行地址
每个进程都有自己独立的运行地址空间
它能够使得他们在独立的访问
内存当中的一个数据
包括他的一些什么指令
他主要就是来看这个事情
所以我们在学的时候啊
那你觉得分清楚是不是啊
分不清楚
那就非常的麻烦是吧啊
这是硬性地址
另外一个呢就是链接地址了
是不是链接地址啊
它就像在什么呢
那就也叫做什么叫做相对地址啊
或者我们把它叫做什么呢
或者叫做这个模块内部地址这种叫法嗯
它是什么呢
是我们程序在编译和链接阶段嗯
这个阶段所生成的这个例子什么意思呢
哈哈既然是链接地址可以编译嘛
提到编译我就明白了
就是在什么呢
相当于在编译嗯和嗯
就是假设你将很多个文件啊
编译成目标文件的时候
每个目标文件都有自己的一个链接地址空间
你没有编之前是没有的
比如现在我写好一个C语言程序
点C是吧
我编译之后它就有一个什么链接地址没有变
没有啊啊
所以链接器它会将这些目标文件合并啊
并且解决那些嗯符号引用关系啊
这种生成的可执行文件链接系统
就会根据那个目标文件链接地址
将它什么转换成加载地址
所以后面我们就讲到什么加载地址
加载地址
这就是我们这叫什么呢
也叫做什么叫做物理地址是吧
就这么个意思啊
物理地址呢它是什么
是程序在加载到内存当中
内存中
内存当中十嗯所处的一个
所处的一个实际物理地址
就是物理位置了
就这个意思啦
就是操作系统他就负责什么呢
把这个可执行文件从那个磁盘加载到内存
把分配的一段联系的物理物理空间嗯
加载器就是我们这个加载器内将执行什么文件
从这个链接地址
把它转换到这个加载地址里面去
并且你把一些数据啊
把一些信息代码复制对应的位置
这样就可以了
程序就能够正常运转
哎就这么个意思啊
这就是我们所讲的一个什么
第19个是吧好
接下来我们就来看第20个
很简单吧
好下面来看第20个
Ok
好第20个是这样的啊
就是硬件中断号给LINUX内核中的IQ
它是如何进行映射的
这是我们在面试过程中经常出现是吧
他怎么映射呢
哎大家也得注意一下是吧
因为是什么硬件总包和IQ
是通过叫做什么映射表
是不是我给你打一下啊
就在什么呢
在LINUX好内核当中
我们硬件中断号啊
呃呃以哪个呢
以这个IQIIQ号
他们是通过什么来通过这个IIQ映射表是吧
英语表达一个什么数据结构
他通过这个映射表数据结构进行什么映射
把它关联起来
是不是
所以所以说此映射表它就保存了什么
保存了你每一个硬件中断
对应的一个什么IIQ号
就这个意思
大家理解
OK好那我们理解这个之后啊
但是还注意什么问题呢
你比如当那个设备啊产生一个硬件中断的时候
CPU它就根据那个硬件中断号去去查找
你这个应IIQ映射表
他会查找这个IQ映射表的号
是不是找到对应的IQ号
然后根据
然后内核就根据那个IQ号
来确定你终端哪个函数
他就执行哪个操作
不同架构它可能IQ不太一样啊
嗯直接搞光搞清楚
那么如果你是X86架构的话呢
那boss或者是固件负责建立这个IQ映射关系
将它传递给操作系统内核就可以了
是不是当时要注意在内核当中
你这个硬件通道和IQ之间
它不总是一一对应关系啊
有的时候呢你这个硬件设备可能会共享
就是有死后
有的时候就是相当于什么呢
就是你多个硬件设备它只能只共享一个IQ号
是不是就是通过函数去处理的
一般我们采用什么比较人性啊
优先级机制来确保每一个设备号都响应
自己的一个终端事件
就这个意思好
这就是我们大家要掌握的
了解这个之后呢
接下来我们就看下一个了是吧
下一个是什么呢
在编写内核代码的时候啊
我们如何选择信号量和复制锁
那你就在这个地方
你就知道什么
你知道这个副词锁跟那个什么信号量啊
它的一个使用的一个环境就可以了
是不是就是具体用哪一个呢
自己来决定的
没有没人帮
没人给你决定的表
是不是嗯好我们就应该考虑这个问题了
就是在什么在写代码的时候就在编写内核嘛
在编写在LINUX
在编写内核代码是不是选择信号量啊
还是这个副词锁唉
主要还是取决于什么呢
需求和设计的一个目标是不是
那接下来呢你要考虑哪些因素才能决定的了呢
第一个就是同步机制了
那为什么这里我们要提到这个同步机制呢
就是如果你需要同步
就说如果你需要实现啊
临界区同步读写操作同步这种场景
那肯定是用复制锁
对不对啊
那是因为副词所提供的是独占性的
只有拥有锁的线程或者进程
就可以执行一些操作
所以同步你就可以使用同步
就用复制锁
另外一种呢是并发访问嗯
什么意思呢
就是如果你需要控制多个线程和进程共享资源
并发行为
那肯定要复制所啊
父子所的话呢
它就可以什么呢
复制锁
它能够确保同一时间只有一个线程或者进程
来访问你这个保护资源
还有一个就是你要考虑的是限制并发量
限制并发数量
为什么
如果要限制同时访问某一个资源数量
哎这个时候你不能使负数了
你要使用什么
要使用信号量
因为什么呢
因为信号量它允许指定一个计数器来控制
你允许同时进行什么操作的一个进程或者线程
就是你要考虑的限制这个问题
还有一个你要考虑的是什么上下文呢
嗯上下文什么意思
在特殊环境情况当中
比如中断处理程序沿子上下文操作
可能而不适合使用同步机制
这个时候呢
你要根据什么情况来选择适合的同步机制
这是一个啊
另外一个的话是什么呢
还有一个就是阻塞与非阻塞的方式
阻塞与非阻塞方式这种情况啊
比如非常简单的一个副词
所父子锁呢通常是使用阻塞的啊
听说父子锁它是阻塞型的
那么当什么呢
当无法获取那个锁的时候
会阻塞信号亮点
它可以灵活的选择什么阻塞或者非阻塞
就这么个意思
这是刚才讲的啊
还有一个我们解决什么
请说明一下
内核使用了一个什么内存屏障的一个场景
什么意思呢
就相当于我们在LINUX内核当中
就是你使用那个什么
就相当于大家在
就是你使用内存屏障的一个场景有哪些好
我们写一个把它拔出来
是不是注意啊
难道并不是很难是吧
但是要思考是这样的
其实我们经常讲的一个什么来内存屏障
内存屏障是一种什么同步的一个原理操作吗
啊原理是不是它是用来确保什么呢
主要用于用于确保嗯
确保对内存的操作按照什么呢
按照我们预期的顺序嘛
一期的顺序执行顺序
一起顺序处理
就这个意思啊
那么他应该就是有几个比较常见
用内存屏障的场景
内存屏障
比如你用的这个自旋锁
刚才我们经常讲的自旋锁
自旋锁和什么呢
和原子操作这种情况他就会用到
为什么呢
之前说过
原子操作就会使用内存屏障
来提供一个副词性和同步性内存屏障
它可以确保这个临界期进入和退出的时候啊
其他线程它只能正确的去同步这个状态
这是其中一种
另外一种是什么呢
内核跟什么设备嗯之间的一个同步
我们就会用到什么
用到这个内存屏障
还有一个就是多处理器嗯
多处理器之间的一个什么数据同步
也会用到什么呢
也会用到我们这个

## 参考

[Linux内核《请页机制详解》_哔哩哔哩_bilibili](https://www.bilibili.com/video/BV1xi421o73f/?p=4&vd_source=4a018e55005b433dc9d72a8e969a1c5f)