好的啊
各位朋友啊
各位同志们
大家好
我是威克
那今天晚上我们接着来学习啊
昨天所讲的这个内容
那昨天呢我们已经把这个LINUX内核的一个什么呢
内存管理架构里面的所有相关知识点
我们全部都讲完了
并且也给大家写好啊
课堂所对应的笔记
包括昨天我们锁了一些录播视频
那没有跟得上啊
嗯这个节奏的话没跟上内容没有关系
加什么呢
可以直接加这个秋香老师的微信和QQ
来领取什么呢
昨天我们所写的这个课堂笔记内容
那么今天我们就接着什么给他继续来讲解
第四点就是这个什么内存映射啊
那抽象老师的这个QQ和微信
现在我就直接给大家发到公屏里面来的
207032995
我现在就划到这了
接下来我们就来学习了以字典
那么我们在学习这个内存映射之前
首先我们看一个看一个最基本的概念
什么意思呢
那么内存映射啊
嗯啊什么意思
就是说这个内存映射啊
它在什么呢
他是在这个定程里面注意啊
他在进程的一个什么呢
虚拟地址空间当中来创建一个什么
创建一个映射
那么这个映射我们可什么都分为什么两种情况
两种
那么我们可以分为哪两种情况呢
接着我们首先来看地图是吧
文件映射是一种啊
你看一种是文件映射
那文件映射是什么呢
就是说比如这个文件
文件支持的一个什么内存映射
他把什么呢
把文件的一个区间区间
把它什么呢
映射到进程的一个什么虚拟地址空间
就这个意思
那么注意啊
这个数据源它是什么呢
是存储设备上的一个什么文件
那这个问题我们就把它叫做什么
叫做这个文件映射是吧
好那我们了解这个文件映射之后
那么还有一种映射
就是第二种
第二种是什么呢
域名映射
那一名映射是什么呢
就说他没有什么
就相当于没有支持的这个什么内存映射
他直接把什么呢
就相当于把这个物理内存要注意啊
他把这个嗯物理内存直接什么呢
把它映射到什么呢
映射到进程的一个虚拟地址空间
哎他没有什么没有这个数据源啊
没有数据源啊
没有数据源
那这个就叫做域名映射
那一般情况下我们是这么认为
通常什么呢
通常我们是把这个文件映射啊
他的一个什么呢
物理页就把它称为什么呢
称为这个文件页嗯
把什么呢
把域名映射的这个什么物理啊
物理液啊
就称为什么呢
称为这个
那我们是跟着这个点进行进一步啊
来详细的学习嘛
把它搞定是吧
嗯我们课堂里面啊有好几个同学是吧
那就说如果你们昨天来
那就没关系
如果昨天没有到课堂的话
记得啊直接找秋香老师来领取
我们前面就是昨天所讲过的内容
包括课堂笔记
视频啊等等
全部都给你根据这个文档来学习
那我们的内核内存管理我们全部都会掌握好
那现在我们来看一下我们还可以什么呀
除了这两个啊映射以外
那么还要注意点什么呢
我们可以根据什么
我们可以根据修改是否对他啊
就是对其他的一个什么
对其他进程的一个什么可见和是否和
是否是否什么呢
传递到什么底层文件
所以这个内存映射啊
哎它又分为什么
分为这个共享映射和什么呢
和这个私有映射又可那么分
那么接下来我们首先来看一个点
你比如这个什么呢
你比如说共享映射是吧
那什么意思
共享映射呢
共享映射它是这样的
就是说比如我们修改唉修改数据的时候啊
映射相同区域的什么呢
其他进程啊
它可以什么呢
可以看见这是一个点是吧
嗯如果是什么呢
如果是文件支持的这个映射
那么修改它为什么被传递到什么
传递到底层文件
这个是共享映射
那我们除了这个共享映射以外
还有一个呢
还有一个就是刚刚讲的叫做私有映射是吧
哎私有意思就是说
比如第一次我们第一次修改数据的时候
它会什么呢
会从这个数据语言呢复制一个什么呢
复制一个副本
那么然后呢我们这个
然后我们就修改这个副本嗯
修改副本
那么其他进程它是看不见的
对不对
你只是修改副本
你又不修改源文件
所以其他进程是不可见的
所以它不会什么呢
它不会影响你要注意啊
它不会影响什么呢
我们这个数据源哎
所以说这个共享映射和私有映射
我们就全部解决了
但是我们要知道
比如啊两个进程它可以使用什么呢
共享的文件映射实现共享内存
那域名映射呢通常是什么私有映射
那共享的域名映射只可能出现在什么
附近城和紫禁城之间嗯
就这个意思
那么现在我们来看一下什么
我们要理解一下啊
这个内存映射的原理是怎么回事
这点要搞清楚是吧
好看啊
这个内存映射是吧
内存映射的原理它是怎么回事
那首先你比如首要比如我们创建
你创建内存映射的时候
哎我们在什么呢
我们在进程的一个用户虚拟地址空间当中
来分配一个什么
分配一个虚拟内存区域
这是一个点是吧
好那我分完之后呢
那么我们注意这什么呢
在LINUX内核当中
他直接采用一个什么
上次我们讲过了
采用一个延迟分配的一个什么呢
延迟分配物理内存的一个策略
他就这个意思
那么在什么在进程的第一次访问呢
嗯这个第一次访问啊
这个虚拟虚拟业的时候
它就会产生一个什么
产生一个叫做缺陷
它就会产生缺陷啊
缺少了缺乏就产生缺陷异常
那如果它是什么呢
如果是文件映射
那么这个时候哎它所分配什么呢
所分配的这个物理页
他就把什么把文件指定这个区间这一个数据啊
把它读到什么呢
把它读到这个物理页里面来了
把它读到物理页当中
然后我们就在什么
然后就直接在列表当中把这个什么把虚拟页
直接什么映射到这个物理
他就这个意思
那如果这个域名业呢要注意啊
如果我们这个域名业啊
如果是域名映射了
对不对
那么就分配物理页
分配这个物理页就这么干
然后呢他在什么呢
然后在这个列表当中把虚拟页
把虚拟啊
把虚拟页映射到时来到物理页
看他的思路
就是我们所讲的内存映射的一个原理
我们现在就搞清楚了
是不是你看这个他根本也不难是吧
嗯那么这些所有的知识啊
基础点我们全部都解决了
解决之后呢
那我们注意在我们的应用层开发当中啊
在应用层开发当中啊
我们专门有一个什么专门有一个叫做第三点
就是应用编程接口
就是对应什么API是吧
下面来看一下啊
这个应用编程接口这个API是吧
那这个应用编程接口API它是什么呢
比如我们所讲的这个内存
内存管理的这个子系统啊
嗯它所提供的什么呢
所提供一些常用的这个什么
常用的这个系统调用对吧
那么它有哪些常用的系统调用呢
那首先我们来看第一个啊
各位朋友们看第一个啊
那第一个就是我们所讲的什么呢
IMAP这个函数
imap a map这个函数它是用来什么
就是用来创建这个什么内存映射的
就是这个函数要搞清楚
IMAP好
那我们除了这个map以外还有什么
还有一个就是第二个了
第二个你比如有什么mv map这个函数用来什么
用来扩大或者是缩小
已经什么缩小已经存在的这个内存映射
对不对
哎可能同时会什么呢
移动哎
这就是第二个我们用到了
还有一个什么呢
还有一个是第三个是第三个123
这是第二个啊
第二个第三个是吧
好第三个函数我们就是mv map
那这个我们前面讲过了
它是用来什么
是用来删除什么
来删除这个内存映射是吧
那第四个就是什么呢
就是BRK了
我们经常用的这个BRK的BRK是用来什么
是专门用来设置一个什么堆的
一个什么上界问题嗯
那么除此以外还有一些相关的函数
比如第四个
第五个是remain下划线file
有一个什么pages
它是用来什么
它是用来创建一个叫做什么
叫做非线性的非线性的文件映射
他来干这个事情
就是我们所讲的什么
就是这个文件期间和什么呢
和虚拟地址空间之间的一个什么映射
它不是一个什么
不是一个线性关系啊
现在啊现在不用了
就这个意思
这是第一个嗯
那第六个还有一个函数是什么呢
n protect是IMPROTECT这个函数
这个函数啊是用来设置什么呢
用来设置虚拟内存区域的一个什么
来访问的这个权限
你根据这个来
那我们就一个一个搞定了
是不是啊
那除此以外你还有些什么呢
你比如说内核提出相关建议啊
叫做第七个吗
还有一个啊叫做m advice
就是M啊
m advice这个函数这个函数啊是用来什么呢
用来向这个内核提出一个什么
提出内存的一个建议
什么意思
就相当于应用程序啊
告诉内核他所期望怎么样
对不对啊
使用指定的这个什么虚拟内存区域
它来干这个事情
那为什么可以这么做呢
主要还是什么
主要还是方便这个内核啊
他可以选择什么
选择一些啊
适合资啊
适合什么
适合的这个阅读
或者是什么和一些缓存技术应用
他就根据这个来对吧
所以每个函数啊有每个函数的用法是不是
但是内核当中是内核空间啊
它可以什么呢
内核空间它可以可以使用什么
就是可以使用两个函数
非常经典的哪两个经典呢
现在我们来看一下啊
我告诉大家
你比如这个看啊
就是内核是吧
就相当于内核空间中可以什么
可以使用两个函数
哪哪两个函数呢
比如第一个啊
第一个remap下划线PFN里面的这个什么ranch
OK是吧
那这个函数它是干什么
它是直接把注意啊
这个函数它是把什么
把内存的一个物理页映射到什么
映射到进程的一个虚拟地址空间
那么这个函数它的用处啊
功能是什么呢
就实现这个进程和内核共享内存
它的功能就是这样的好
那我们除了这个以外还有什么
还有第二个了
这个是IO下划线
remap里面的pf n ranch
就这个算好
这个函数是做什么
他是把什么呢
是把外设这个寄存器的一个物理地址
直接把它映射到什么
映射到进程进程的一个什么啊
虚拟地址空间
但是要注意这个进程它可以什么进程
可以直接访问一个什么外设的一个寄存器啊
哎所以内核空间当中可以使用的两个成员函数
你看我们就全部别摆平是吧
就是你做开发的时候就根据这个来就行了
好那我们掌握这个之后啊
我们后面还有什么呢
你比如比如我们系统调用是不是
那比如一些系统标
就说你怎么去操作呢
你比如这个IMAP是不是比系统的IMAP
比如你创建什么
你进程创建域名映射内存
他把什么呢
把内存注意啊
他把内存的一个物理页
映射到进程的一个虚拟地址
他就这么一回事是吧
哎这个也不难啊
好完了之后呢
你比这个进程进程
他把这个文件映射
是不是映射到什么进程的虚拟地址空间
那可以像什么访问内存一样的访问文件
那这个时候就不需要调用那个系统read和write
那个文件要避免什么
避免用户啊
用户模式跟内核模式之间的切换
提高什么
提高效率来主持做这个事情啊
大家搞清楚
就是我们所讲这个问题就相当于什么呢
就相当于我们要要要搞清楚这个系统调用卡
比如这个系统调用系统干什么呢
这个IMAP你像这个函数
我举个例子啊
那这个IMAP它的用处
它的用处在哪里是吧
我们搞清楚用处是这样的
这个进程进程创建什么呢
进程创建域名
内存映射的时候是吧
那么他就把什么
就把内存的一个物理液啊映射到什么
映射到进程的一个虚拟地址空间
他来干这个事情是吧
这是一个点
另外一个呢这个进程它会把什么
会把这个文件映射
会把这个进程把这个文件映射
把文件映射到什么呢
映射到进程的一个虚拟地址空间好
那么他就可以什么可以向啊访问什么
访问这个内存一样
就像访问这个内存一样的访问某一个文件
就是映射的时候对不对
这样的话他就不需要什么
你就不需要调用那个系统
就不需要调那个系统
调系统调里面专门有个什么装一个read
看到没有
系统调里面专门有一些相关的函数
就是瑞德或者是一些right啊
这些函数来访问这个文件
你看他来做这个事情
所以我们在做内核开发的时候就这么做啊
还有什么
还有一点就是说他这样做的原因
就是说他可以什么啊
它可以避免就是他直接可以避免什么呢
避免我们这个用户模式啊和什么呢
和内核模式之间的一个什么切换
是这个意思
那主要还是提高什么呢
一个是提高读
那另外一个提高写这个文件的一个文件的速度
他来干这个事情是吧
好那么这是一个点啊
另外一个点就说出来
你比如两个进程对吧
两个进程的针对什么呢
针对同一个文件呃
创建什么
创建共享的内存映射
对不对
那这样的话它就可以达到什么
达到实现这个达到实现共享内存的目的
所以就说你通过这个函数就可以解决这个问题
是那就给解决了
是不是啊
解决了问题之后呢
那么接着调用map函数
别着急啊
我们可以找一些官方文档去查了
否则根本查不到
是不是对这个IMAP这个函数
大家看一下这个浏览器
搜一下是不是
我们一个一个来啊
不要着急是吧
你比什么呢
比如这个IMAP贝特
双击
好那现在我们看到了啊
你看word是吧
星号map word d
看到没有
还size t length
这个int port port是吧
Int flag
还有一个F1
后面有什么呢
毫米offset
那么这就是我们所讲这个函数的原型
你要搞清楚这个函数的原型好
那么针对这个函数的言行来看一下啊
你要研究
那么就研究透彻是吧
那么针对你看啊
这个言行就是函数的一个什么原型
那这个函数原型这样呢
哎这个这么没关系啊
我就这样放到这了啊
Ok
把它移到这边来
虽然i int是吧好
那现在我们所看到的这个函数对吧
a map a map这个函数他怎么做
每个参数是不是
那你比如它相当于一个ADD
是不是
那么这个ADD这个参数啊
注意啊
这个参数
看看参数参数
你比如AD d ADD
它就是一个取舍
什么是一个起始的一个虚拟地址
你如果什么呢
如果这个ADD它为几啊
ADD为零
那么内核那你选择什么
选择虚拟地址要那如果这个ADD的参数啊
刚才解释D参数它不为己呢
它不为零不为零
它内核呢就把什么呢
把这个参数啊作为一个什么呢
做一个提示啊
直接在这个附近啊
选择什么呢
虚拟地址他能做到这个事情我们就摸清楚了
是不是就是这个参数是吧好
那我们除了这个参数以外
还有什么看啊
还有第二个
第二个就是这个length这个参数是吧
那length这个参数它就是表示什么
表示映射的一个长度单位
它是一个什么单位
是字节是吧
那后面这个是什么port port
而这个project是一个什么
它就是个保护位
那这个保护费是这样的
它的取值很多啊
比如他有pro下划线
一个EXEC是吧
这个是表示什么E它可以什么也可以执行
这是其中之一
还有一个什么pro下划线read是吧
这个表示页它可以读
read可以读
还有一个BT下划线right
这个都知道了是吧
这个表示页它可以什么可以写
还有一个是float下划线
有个NNOK那这个来表示页
它不可以什么不可以访问
他就根据这个部分一步一步来是吧
这是其中之一啊
就是这个我们所讲pro这个参数
那么后面还有一个什么呀
还有个flag
还有个flag
OK啊
它这个取值
搞定了
没问题下
我们看下面这个下面这个是flag flag
它是一个什么
是一个标志
对不对
是个标志啊
那比如一些常用的这个标志啊
在下面看常用标志
你写程序的时候
这个我们就很清楚了
是不是常用的常用如下是吧
好下面看这个
那你比如哪些呢
比如我们先看第一个是吧
比如石油共享和这个什么呢
共享映射
比如它如果你带一个参数
你有个参数
map是不是map这个下划线有什么需下划线啊
shell那这个是表示什么
表示共享映射
那如果是map下划线个private就代表私有
是不是
那私有的话呢
在这里他就表示什么表示这个私有意识嗯
还有就是IMAX下划线或者什么NO notes
这个参数它表示什么表示域名次
就这么讲是域名映射
还有就是什么呀
还有就是map下划线有一个什么固定的啊
fixed i x e d是吧
那这个fixed它是一个什么
是一个固定映射的函数
就是说相当于它不需要把参数ADD啊
这个解释作为一个提示
那么映射的起始地址它必须是常数
IDD必须是一长度的一个整数倍
还包括一些机型页啦
你比如这个map下划线还有什么后果
TLB是吧
嗯那像这个参数这个是什么
这就是我们使用的一个叫做句型是吧
那除了进行一个之后呢
你比如IMAP下划线有个什么洛克的是lock
什么意思呢
他就把这个页啊干什么呢
把这个页啊锁在什么呢
把这个页锁在内存当中
多内存当中还有什么
还有这个IMAP下划线有个NO rice
这个参数这个参数它是不预留啊
不预留的这个什么物理内存
除此以外还有没有啊
有啊它还有很多参数了
对不对
你不堵塞的填充列表的是不是都在里面
这就是我们所讲的flag这个参数
还有一个呢还有一个是FDFD的参数
FB这个参数就是文件描述符的参数
文件描述符什么意思
那这个文件描述符什么意思
就是说仅当我们创建文件映射的时候
这个参数啊它才有意义嗯
如果是域名映射
有一些实现要求这个参数FD为一
那么可以移植应用程序
应该保证F这个参数FD应该是一
后面不还有一个呢看这个offset这个参数
offset是干什么
就是我们所讲的一个偏移
注意啊是一个偏移
但是它单位是什么呢
单位是一个字节
必须是叶长度的一个什么整数倍
就这个意思
那么就是说当我们创建了个文件映射的时候啊
这个参数啊才有意义
就是说你比如返回
如果啊还是你操作这个函数的时候
它有一个什么一个返回值了
这个返回值返回值是什么意思啊
那如果成功
那我们就返回一个什么返回一个起始虚拟地址
否则那就返回一个什么
返回一个负的这个错误编号来告诉我们用户
你看所以这些相关参数那我们就全部解决了
就是你在应用开发当中
那是必不可少的
并且在座各位朋友们是吧
大家都知道你要搞得非常细
那就必须要达到这个点是吧
除此以外还有一些相关的函数
比如我们怎么去设置这个选区是吧
是不是传输进去之后
你看啊
我再起个函数
这是其中的一个函数啊
系统的一个函数
我们再看一个函数的原型
你看看函数原型
就是系统调用是吧
这个protect这个函数
那么这个函数它是用来什么
就是相当于用来设置这个虚拟内存区域的
一个什么访问权限
它就这个意思
那么他这个函数原型
那你要找官网里面相关的这个解释是吧
这下面看函数的原型
那这个函数原型在这里啊
那你只有输了
你输了不记得啊啊这个
比较慢
耐心等待一下
好多参数你看没
and protect啊
这个不行
算第二个
好M这个protect
LINUX啊
这个一好
那下面看到了
你像这个函数
这个函数用到它所必须要加上那个头文件
嗯在这里这个它是函数的原型
那么这个函数的原型你要注意啊
那首先你看第一个参数
第一个参数
比如这个参数
跟上面那个是一样的参数
你首先看第一个ADDRADDR
它是一个什么取使虚拟地址对吧
它必须是什么呢
必须是一长度的一个什么整数倍
就这个意思
除此以外
还有第二个参数
Ln l e
这个参数就是虚拟内存区域的一个长度单位
它是一个什么
是一个字节
还有一个还有一个是保护位了
Protect
这个是保护位
是保护位
那这保护跟上面一样的
保护位
诶
啊这个就这四个啊
好非这是个一个是页可执行的
一个是也可也可写的
也不可访问的这四个参数啊
它的取值好
还有一个什么
当我们调这个函数
它有一个返回值要注意啊
接下来我们看看返回值
那么它的一个返回值是吧
是这样的
就是说如果你调那个函数成功
他就返回零告诉我们了
对不对啊
证明你指定设置成功
那否则呢这个时候他就返回什么
返回一个负的这个错误后
啊就这么干了是吧
其实还有很多
除此以外
你比如什么
比如一些其他释放啊什么之类的
其他的一些相关函数
大家可以一一的把它看出来是不是
但是接下来我们要学习什么
学习这节课的第四大点
第四大点你要了解什么内存区域的一个什么
就是虚拟内存区域的一个数据结构
第四个第四个第四个是虚拟内存啊
区域的一个什么呢
数据结构是不是什么意思呢
好那现在我们来看啊
它相当于什么呢
相当于是这样的
你比如啊这个虚拟内存区域啊
它是什么
是分配给进程的一个什么进程的
一个虚拟地址范围
虚拟地址范围
那么内核呢他使用这个结构叫做VM下划线
error是吧
下划线一个structure专门来描述这个虚拟内存区域
那么内核的一些什么呢
主要内核就是野马来看啊
比如他这个野马分析是不是主要成员如下
我们来看一下
那现在我们就打开这个内核源码
是不是进行进一步的分析
因为你学习内核
这个你不用急是吧
也不用着急
你着急没有用是吧
一下子可以掌握很多知识
可以了
我们找到这个
Mm structure
注意啊
mm struck这个结构体里面
他就专门有一个虚拟内存去套上去
等一下
嗯虚拟内存区域就这个看量VMSTRUCTOR没有
Vm astructure
这个是虚拟内存区的链表图
指定了
只能IMAP嘛
那现在我们看到的成员
哎
看不过来
是吧
嗯在这里
现在我们来看啊
导到这儿来了
这个要注意了
这个结构体注意啊
它是什么呢
是我们所讲的虚拟内存区域
的一个什么数据结构
内核的一个数据结构啊
哎那他这个数结构在哪里呢
那我们在找他的时候
你会写到这来
我直接把它捡过来
放到这个笔记当中
那么到时候你找上
你一定要记得在include下面的LINUX
下面一个mm下划线TP就可以了
来接着我们看啊
我们针对这个掩码来分析是吧
它主要条件有哪些
你首先看第一个第一个VMVM是吧
这个很简单
第一个就是起始地址是像那个vm end
就是结束地址了啊
结束地址对吧
那么区间它是一个什么区间
是这个是不是它不包含什么呢
就是相当于它不包含这个节奏这个意思
那么区间就是起始地址到什么
来到这个结束地址
括号中
括号中括就包含在里面了
还有什么
还有一个你比如这个看这里啊
有一个专门它指向他们
有个指针
看到没有
这就是虚拟内存
虚拟内存区域的一个列表
按照什么来
其实地址进行排序
可以
嗯这里是区域内存区域链表是吧
他直接按照什么
按照起始地址进行排序
后面有一个什么
有个VMRB了
那这个VMD是什么意思
这是一个红黑树是吧
这是红黑树的一个节点
嗯红黑树的一个节点
那个红黑树节点我们再往下面啊
比如这个要找一些核心成员要注意啊
他们表示在这个地方看到没有
TRUMM有个什么v mm这里来嗯
这个成员这里面是什么呢
就VM下划线mm
它这个指针是专门来指向什么
指向这个内存描述J就像一个什么呢
就像一个区内存虚拟内存区域
它所属的一个什么呢
用户虚拟地址空间嗯
就这个意思
就这个成员啊
这个是内存结构体要舒服吗
内存内存描述符
那还有什么呢
还有下面你比如有个pg下划线T
那这个常年这个成员他是一个什么
是个保护位啊
就是相当于访问权限了
这个意思吧
这个访问权限吗
保护位VMI是吧
那就相当于一个保护位
保护位就相当于我们这个访问权限是吧
好戒掉啊
后面我就不在这里
然后后面还有个标志了
你看inside log vm flags
这个是访问标志标志区域内的标志
那这个新类型标志的话
你看后面啊
后面他有一个什么
有个STRUCT
看到没有
他这个RB你看这个红黑树now的这个节点是吧
调到这来last算
那么其实它的地方主要是告诉我们什么呢
就是说这地方他只是为了什么呢
就是为了支持我们这个查询一个什么
查询一个文件期间为什么呢
为映射会映射到哪一些什么呢
哪一些虚拟内存区域
就这个意思
把一个什么把一个文件映射到什么
映射到所有的一个虚拟内存区域
把它加入到什么呢
加入到该文件的一个什么
该文件的一个地址空间结构体
那地址空间结构体里面装了一个
后面会讲address下划线
一个space当中它有一个什么
装了一个成语叫RMM
装个成员来指向什么
指向一个区间数
他就做到这一点
除此以外
我们再加一个核心点成员啊
叫做这个成语
这个VMICHA这个成员
其实这个重点是干什么
这个成员他是把什么
就是把这个虚拟内存
把虚拟内存区域所关联的一个什么呢
所有的一个这个部分啊
实力VMI这个磁力
VM10来把它进行串联起来
串起来呢就是一个虚拟内存区域
它为什么会关联到一个什么附近的N下划线
VMA的一个实例和什么
和自己的一个VM实例来做这一点是吧
这个不能
那么除此以外后面还有一个呢
看到没有一个VMI是吧
自己的
你像这个
这个是什么意思呢
这个就说它相当于什么
就是这个指针是专门用来指向一个什么
NO下划线VM实例指向实例
但是他这个结构体这个结构体呢是用来什么
用来组织这个组织域名业为什么被映射到什么
映射到所有的一个什么所有的虚拟地址空间
嗯哈来看就这个事情就这个部分啊
还有一个什么还有个虚拟内存操作几何
较慢是
一下子反应不过来啊
嗯这里面就是虚拟内存操作的一个什么呢
集合全部的结构体增删改查
还有一个什么呢
还有一个VM下划线
Page of
这个配件就是文件的一个偏移
文件偏移那就是单位单位是什么
单位为一
再往后面有个什么vm file
你看下面啊
那下面这个成员我们讲最后一个不讲了太多了
是不是一个一个讲太多了
你比下面那个vm file
Vm file
它是一个文件
如果它是什么呢
如果是私有私有的这个域名映射
对不对
那么这个成员的这个指针啊
指针它就为什么就为空
就这个意思啊
后面还有很多啊
我们就不再列举了
现在我把这个内核的源码
直接放到我们的笔记当中
那么这个虚拟内存区域根据我们的
然后打开文件索引节点
它是一串关联的
这个大家知道
这野马就出来了
那下面我们来看一下下面针对什么
下面我们针对这个文件映射
文件映射在一个什么虚拟内存
虚拟内存区域
文件映射的虚拟内存区域
它这个什么结构结构关系如下是吧
好我们来看一下啊
我们怎么去表示它呢
专门有个图啊
就是昨天我们画的那个图了
一步一步来啊
昨天专门有一个task structor是吧
这个结构体他看他怎么去指向
后面去指向嗯
你先看这个啊
看出来了
你像这个进程描述符是吧
进程描述符
那现在我们要找到什么
找到了进程描述符
那进程描述符呢还有个什么
还有一个内存描述符是吧
把这个画出来
等一下我们再往里面填充这个成员
嗯可以了
啊这个我们就解决了啊
啊这个是进程要说服
进程描述符后面还有一个内存描述符吧
那个叫做什么呢
内存
嗯内存要舒服
就是mm
没有好
那么这个内存描述符之后看到没有
你看啊
好内存描述符之后
还有一个什么虚拟内存区域嗯
还有一个虚拟内存区域
虚拟内存
虚拟内存序列就是VM下划线
error下划线还有什么负嗯
他们之间的关系
那么装有指针去指向
又回到这了
你看啊
但是这里面呢它又有什么呢
又有对应的这个操作集合
比如他有个操作集合
CTRLC是吧
虚拟内存区域
它里面有什么呢
有虚拟内存操作这个集合
虚拟上集合是这个啊
就这个vm operation struck
但是这个结构看到没有
这个结构呢还有什么呢
还有就是文件啊啊啊
把这个删掉
啊还有文件啊
你比文件就是文件文件的一个什么
打开实例叫做file
对不对
file1file里面又可以指向的内存
就是这个文件索引节点
I know
后面就是文件的文件的一个什么呢
索引节点
I know
这样的话他就一步一步把它指向起来
是
好它们之间的关系要怎么做
首先我们看第一个
我再找两个子弹就行了
有这里面还有很多很多的这个
这里面很多很多个
好这个成员里面其中就是这个了
看到没有这个OPS
看到没有
这个OPS这个指针干什么
这个指针是专门来指向什么虚拟内存操作
结合它指向这一块的
你要搞清楚
还有一个是文件file
看到没有
Vm file
看到没有
把这个vm file
列到这来
那这个VMF是指向下面来的
看到没有
到这来
就是你打开这个文件的实例了
那这个操作集合里面啊
我给这个file里面
这个没直接超链接
这个有问题啊
别急
我先来翻一下
我换一个啊
其实放一个放一个5.0都是一样的啊
这样的话我们导看一下
好可以
那么可以之后
那么同样的道理啊
我们先找到这个进程的数
include下面的linux shell
那这个CD啊S
CH一点H好
就这个啊
在这里面注意这个成员里面有哪个虚拟内存区
是mm structure
哪里看啊
mm都在这里看到没有
还有这些相关指针
这里来啊
就是这个这个就是进程描述符
这是第一个进程描述
有个mm structure
这个指针指向内存描述符
那么就随便找一个啊指向他的图片就可以了
这个
里面很多啊
到这来
嗯就这两个指针是吧
可以
那么假设啊
内存描述符这个指针就指向这一块来了
看到没有
好这是我们现在所看到之间的关系啊
接着什么
接着你在这里面这个mm structure是吧
你把鼠标放上来
按住CTRL键
他这个跳过去较慢
没有按一下还不行是吧
并在下载哦
比较慢是吧
就是说你找到这来有一个mm下划线TP
啊这里来好
然后再找到什么CTRLF
看这个结构体还没有
在mm这个structure里
他就有这个虚拟内存区域了
他这个指针是指向这个部分的
他就这么一个关系
还有一个什么
再找一个重点
这是E的
我就不管了
页目录我就不管了
就这么个关系是吧
嗯这两个就分别指向了
是不是那个VM这个分别指向了哈
他这个列的操作集合啊
比如虚拟存操作集合
那就找到这个结构体
这个结构体
那么它所对应的这个指针CTRL加F
看到没有
要把它传过去啊
可以了
没跳过去
好这个打不开了
这比较麻烦
麻烦的话我们就直接倒了
这个没办法
是不是
这就直接导
嗯框架C框架F
mm下好像table还有一个它里面有很多成员
比如它有哪些成员呢
我们看一下他有这个成
你比文件操作集合里面也有int是吧
比如MK是有一些相关的函数吗
配置下划线
Mk right
比如STRUCTVM下划线float乘上VMF
来干这个事情是吧
好干这个事情之后呢
这里还有比这个文件实例的
文件里面还有节点呢
就专门有个struct i note里面的信号F下划线
i know是吧
这个是干什么
这个是像文件的一个什么索引节点
干掉是吧
那么这个指针它就指向什么
指向那个部分
指向什么
指向这个文件来索引节点
它大致就这个关系啊
啊这个关系我们全部都讲完了
可以了
你看现在我们所看到的这个关系
就非常容易理解是吧
他从什么呢
从这个注意啊
从这个进程描述是吧
一直到内存描述符
内存描述符呢再到什么
再到下面这个内存
虚拟内存区域
虚拟内存序列
再到这个
你比如操作文件之后
打开文件实例
还是整套流程
嗯已经搞定了啊
我把这个图形啊放到这边来
就可以
解决了
所以这个关系啊
在大脑里面我们有这个概念了
有了概念之后呢
那就是文件映射它的一个什么虚拟内存区域
那么接着什么呢
接着我们要搞清楚
你比如这个讲了这个F下划线
按node是不是包括这个VF啊
嗯你比这个成年这个VFVM下划线file
不要不相信派什么是直线给我打开文件实例
做他这个索引节点就代表一个文件
注意啊
索引节点就代表一个文件
描述这个文件的属性是吧
还有VF什么
比如pg of啊
跟我们讲了VF1P7off是吧
那就是存放文件列为单位的一个什么品
他讲这个了
是不是好
除此以外
那么整个啊整个操作方式就非常的简单了是吧
就很乱
很容易的去理解
这个要搞清好
那么这个我们一旦摸清楚之后
那后面我们就来学下一个了
是不是下一个你比如什么
比我们针对这些相关操作
比如m map点C啊
那怎么去执行呢
是不是啊
比如一些树啊和这个什么树和这些链表啊
不对
那么虚拟内存区域它上照这种方式啊
进行性存放的
这个我们要摸摸清这个观点就行
你比那个虚拟内存操作集合是吧
那么虚拟内存操作集合
你给他定各种各样的操作了
是不是
就是定义什么
定虚内存操作区域的一个相关方式
比如open的clouds啊啊等等啊
下面我们来看下一个点
就是链表一竖
链表和这个数是吧
那我们为什么列表数呢
就是进程的进程的一个虚拟内存区域
它是按照什么呢
它主要是按照它是按什么
按两种方式嗯
方法进行什么进行排序的
按照两种方法
好那两种方法
现在我们往这边看啊
我画一个图形是吧
按哪两种方法
比如虚拟内存的一个区域
是不是刚刚我们提到了啊
从哪里呢
从这个地方来看
从这个地方来看下C就行了
看下C粘贴放到后面
啊这个看到没有
那么这个的话呢
它里面有一个什么呢
这个mm是指向内存
嗯好指向内存描述
内存描述符呢里面装了一个map
没有map啊
还有一个MMRB
好我们找到这个mm TP有一个Ctrl f mm下划线
刹车里面有一个在这个地方专门有这个成员
看到没有啊
那这个成员啊中间其实它有很多很多成员
大家也清楚
Ok
好到这边来的话
你看啊
我们到这边来了
那到这地方来的话呢
现在把这个起来
用飞色来表示
这颜色改下
OK那么它有一个什么
有这么一个组成
这两个成语他怎么去向是吧
你比如现在还有一个什么
有个实例啊
虚拟内存区域这个实例
好我们来看这个虚拟程序实例啊
这个红黑树怎么发
一个节点是吧
好再画一个两个
三个
然后再画两个啊
好基本差不多啊
用这个来描述一下
好整个结构
他怎么去指向你看啊
他们之间的连接又一根线啊
它的基本结构啊
看一下这里
嗯整体思路啊
嗯完了之后呢
你要注意啊
我们这个指针
这个红黑树可没有一个RB下划线绕成
那么mm向IB他就专门来指向这里换来的嗯
他必须要有一个指针
看到没有
他这个指针就指向他的
他指针指向这样来
但是你看啊红黑树之间它的节点呢
你比如我这个下划线map
是不是哎它就指向这个叶子节点
比如指向这
完全把它支起来看没有
就这么一个关系
比如这个
哎他只想占来
啊这里面
红黑树啊
哎这里来
它的结构是这样的
但是每一根这个弯的线啊
你要注意啊
比这些弯的线
它是一个什么用的
C先表示嗯
他是一个什么
是一个双向的
要搞明白颜色
我们用红色来表示看好
现在大家所看到这个图形
注意啊
我们现在大家所看到这个图形它就代表什么呀
代表这个啊
新内存区域的一个什么链表和这个数啊
那么就说它代表什么VMROSTRUCTURE
是不是就代表这个VMROSTRUCTURE
这个就这么进行表示了这个框框
这里啊这个这个框框是代表这个VMASTRA的实力
那么之间之间通过什么
通过链表和红黑树进行进一步操作
就没问题了是吧
现在我把这个笔记啊翻过来
这个颜色改一下是
可以
把这些搞完一点
不然不好表示
就这个就没问题了
算这里看的很清楚啊
接下来
把它放到这来
啊对对它的数据结构了
你看到没有
那么在这里所表示的有个点是什么意思
就是说第一个是双向链表是吧
第一个啊
第一个点它是双向链表
双向链表什么呢
M下划线这个点什么map map是指向什么
指向第一个一个VM下划线error
这个实例要注意
就是这个指针没有M指指向第一个
好那么我们现在搞清楚之后
还有个2B是2B指向根节点
第二个点
就是红黑树
mm下划线这个structure点是什么呢
这个mm下划线RB这个成员
它是指向这个红黑树的一个什么根
像红黑树的根
但是你还注意一个问题
什么意思呢
你比如比如我们这一个什么呢
就是说这个虚拟内存区域
虚拟内存区域它使用什么来使用
起始地址和提示地址和什么呢
和结束地址我们描述对不对
但是这个链表它是按什么呢
按起始地址点递增进行排序啊
那这个红黑树呢它是平衡的一个什么
平衡的二字二叉查找树干了一个执行
那么按照这个起始地址的一个排序
那么它能够使这个什么
能够使这个红黑树啊
有如下啊
这个功能哪些功能啊
你比如我们可以在什么在红黑树当中来查找
查找一个什么
查找一个虚拟内存区域的一个什么速度快一点
是不是第二个呢
你比如你增加一个新的这个区域的时候
那么现在什么呢
我们又是先在这个红黑树当中来找到什么呀
找到刚好刚好在什么
在新区域前面的一个什么区域
然后呢
我们就像什么
像链表和这个数当中插入一个什么
插入一个新区
那这样的话它就可以避免什么免扫描这个链
表示你这么做
OK现在已经到这个9.20啊
大家休息一下
是不是就休息10分钟
然后我们再继续啊
大家休息一下
休息10分钟啊
那我们再继续
在09:30开始
09:30继续
21.30再继续
大家可以喝口水休息一下
是那后面来的啊
各位同志们又说没有跟上这个节奏的话
记得啊
导秋香老师林奇
今晚的课堂笔记
包括这个视频是吧
相关的学习资料
包括昨天的都可以啊

## 参考

[B站字幕转换 | 牧尘的NAS小站 (dreamlyn.cn)](https://www.dreamlyn.cn/html/bsrt.html)