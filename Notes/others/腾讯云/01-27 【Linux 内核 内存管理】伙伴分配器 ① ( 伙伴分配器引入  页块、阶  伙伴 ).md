#### 文章目录

-   [一、伙伴分配器引入](https://cloud.tencent.com/developer?from_column=20421&from=20421)
-   [二、页块、阶](https://cloud.tencent.com/developer?from_column=20421&from=20421)
-   [三、伙伴](https://cloud.tencent.com/developer?from_column=20421&from=20421)

## 一、伙伴分配器引入

* * *

Linux 内核 初始化 完成之后 , 就会 丢弃 引导内存分配器 , 如 : bootmem 分配器 , memblock 分配器 ;

此时 , 使用 " 页分配器 “ 管理 ” 物理页 " ,

" 伙伴分配器 “ 就是 ” 页分配器 " , 其特点是 算法简单 , 性能高效 ;

## 二、页块、阶

* * *

**伙伴分配器 有如下概念 :**

**页块 ( Page Block ) :** 英文名称 Page Block , 指的是 连续的 " 物理页 " ;

**阶 ( Order ) :** 物理页 的 数量单位 ,

nn

阶页块 指的是

2n2^n

个 连续的 " 物理页 " ;

**如 :**

00

阶页块是

20\=12^0 = 1

个 连续的 " 物理页 " ;

11

阶页块是

21\=22^1 = 2

个 连续的 " 物理页 " ;

22

阶页块是

22\=42^2 = 4

个 连续的 " 物理页 " ;

⋮\\vdots

nn

阶页块是

2n2^n

个 连续的 " 物理页 " ;

## 三、伙伴

* * *

22

个

nn

阶 " 页块 ( Page Block ) " 在满足 如下

33

个条件的前提下 , 可以 称为 " 伙伴 " :

**① 页块相邻 :**

22

个 页块 ( Page Block ) 必须相邻 , 其物理地址是连续的 ;

**② 页块页号 :** 第

11

个物理页 页号 是

2n2^n

的整数倍 ;

**③ 合并页块 :** 如果需要合并这两个

nn

阶页块为

n+1n + 1

阶页块 , 则第

11

页的 物理页 页号必须是

2n+12^{n + 1}

整数倍 ;

00

页 与

11

页是伙伴 ;

22

页 与

33

页是伙伴 ;

11

页 与

22

页不是伙伴 , 这两页如果合并成页块 , 其第一页的页号不是

2n+12^{n + 1}

整数倍 ;

## 参考

[【Linux 内核 内存管理】伙伴分配器 ① ( 伙伴分配器引入 | 页块、阶 | 伙伴 )-腾讯云开发者社区-腾讯云 (tencent.com)](https://cloud.tencent.com/developer/article/2253535)